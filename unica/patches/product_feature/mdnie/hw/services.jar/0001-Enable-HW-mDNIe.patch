From 890b1cce2cd02a44060ea3a53823880c29f206a9 Mon Sep 17 00:00:00 2001
From: ExtremeXT <75576145+ExtremeXT@users.noreply.github.com>
Date: Tue, 16 Sep 2025 20:59:45 +0300
Subject: [PATCH] Enable HW mDNIe

Change-Id: I2945c57aaf9e663469500d624915e1af8c1c090c
Signed-off-by: ExtremeXT <75576145+ExtremeXT@users.noreply.github.com>
---
 .../AccessibilityManagerService$2.smali       | 133 ++-
 .../AccessibilityManagerService.smali         | 266 ++++-
 .../EyeComfortSolutionService.smali           | 531 +++++-----
 .../MdnieScenarioControlService.smali         |   2 +-
 ...MdnieManagerService$SettingsObserver.smali | 184 +++-
 .../display/SemMdnieManagerService.smali      | 920 ++++++++++++++++--
 .../custom/KnoxCustomManagerService.smali     | 202 +++-
 7 files changed, 1814 insertions(+), 424 deletions(-)

diff --git a/smali/com/android/server/accessibility/AccessibilityManagerService$2.smali b/smali/com/android/server/accessibility/AccessibilityManagerService$2.smali
index d3122850..6469811a 100644
--- a/smali/com/android/server/accessibility/AccessibilityManagerService$2.smali
+++ b/smali/com/android/server/accessibility/AccessibilityManagerService$2.smali
@@ -79,14 +79,28 @@
     goto :goto_0
 
     :cond_1
-    iget-object p1, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
+    iget-object p2, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
 
-    invoke-static {p1}, Lcom/android/server/accessibility/AccessibilityManagerService;->-$$Nest$menableColorLens(Lcom/android/server/accessibility/AccessibilityManagerService;)V
+    invoke-static {p2}, Lcom/android/server/accessibility/AccessibilityManagerService;->-$$Nest$menableColorLens(Lcom/android/server/accessibility/AccessibilityManagerService;)V
 
     :goto_0
+    iget-object p2, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
+
+    invoke-static {p2}, Lcom/android/server/accessibility/AccessibilityManagerService;->-$$Nest$menableColorRelumino(Lcom/android/server/accessibility/AccessibilityManagerService;)V
+
+    iget-object p2, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
+
+    iget-object p2, p2, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
+
+    invoke-static {p2}, Lcom/android/internal/accessibility/util/AccessibilityUtils;->isInDesktopWindowing(Landroid/content/Context;)Z
+
+    move-result p2
+
+    if-nez p2, :cond_7
+
     iget-object p0, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
 
-    invoke-static {p0}, Lcom/android/server/accessibility/AccessibilityManagerService;->-$$Nest$menableColorRelumino(Lcom/android/server/accessibility/AccessibilityManagerService;)V
+    invoke-static {p1, p0}, Lcom/android/server/accessibility/AccessibilityManagerService;->-$$Nest$msetColorAdjustment(Landroid/content/Context;Lcom/android/server/accessibility/AccessibilityManagerService;)V
 
     goto/16 :goto_2
 
@@ -97,7 +111,7 @@
 
     move-result p2
 
-    if-eqz p2, :cond_6
+    if-eqz p2, :cond_7
 
     iget-object p2, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
 
@@ -261,9 +275,24 @@
     invoke-virtual {p2, v2, v4, v0, v1}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
 
     :cond_4
+    iget-object p2, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
+
+    iget-object p2, p2, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
+
+    invoke-static {p2}, Lcom/android/internal/accessibility/util/AccessibilityUtils;->isInDesktopWindowing(Landroid/content/Context;)Z
+
+    move-result p2
+
+    if-nez p2, :cond_5
+
+    iget-object p2, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
+
+    invoke-static {p1, p2}, Lcom/android/server/accessibility/AccessibilityManagerService;->-$$Nest$msetColorAdjustment(Landroid/content/Context;Lcom/android/server/accessibility/AccessibilityManagerService;)V
+
+    :cond_5
     sget-boolean p2, Landroid/view/accessibility/A11yRune;->A11Y_COLOR_BOOL_SUPPORT_COLOR_FILTER_MDNIE_HW:Z
 
-    if-eqz p2, :cond_5
+    if-eqz p2, :cond_6
 
     iget-object p2, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
 
@@ -271,7 +300,7 @@
 
     goto :goto_1
 
-    :cond_5
+    :cond_6
     iget-object p1, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
 
     invoke-static {p1}, Lcom/android/server/accessibility/AccessibilityManagerService;->-$$Nest$menableColorLens(Lcom/android/server/accessibility/AccessibilityManagerService;)V
@@ -281,7 +310,7 @@
 
     invoke-static {p0}, Lcom/android/server/accessibility/AccessibilityManagerService;->-$$Nest$menableColorRelumino(Lcom/android/server/accessibility/AccessibilityManagerService;)V
 
-    :cond_6
+    :cond_7
     :goto_2
     return-void
 
@@ -305,7 +334,7 @@
 
     move-result v6
 
-    if-eqz v6, :cond_7
+    if-eqz v6, :cond_8
 
     iget-object v6, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
 
@@ -333,7 +362,7 @@
 
     invoke-virtual {v6, v9, v7, v8, p1}, Lcom/android/server/accessibility/AccessibilityTraceManager;->logTrace(Ljava/lang/String;JLjava/lang/String;)V
 
-    :cond_7
+    :cond_8
     invoke-virtual {p2}, Landroid/content/Intent;->getAction()Ljava/lang/String;
 
     move-result-object p1
@@ -344,7 +373,7 @@
 
     move-result v6
 
-    if-eqz v6, :cond_8
+    if-eqz v6, :cond_9
 
     iget-object p0, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
 
@@ -360,14 +389,14 @@
 
     goto/16 :goto_c
 
-    :cond_8
+    :cond_9
     const-string/jumbo v6, "android.intent.action.USER_UNLOCKED"
 
     invoke-virtual {v6, p1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
 
     move-result v6
 
-    if-eqz v6, :cond_a
+    if-eqz v6, :cond_b
 
     iget-object p0, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
 
@@ -390,7 +419,7 @@
 
     iget p2, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mCurrentUserId:I
 
-    if-ne p1, p2, :cond_9
+    if-ne p1, p2, :cond_a
 
     invoke-virtual {p0, p2}, Lcom/android/server/accessibility/AccessibilityManagerService;->getUserStateLocked(I)Lcom/android/server/accessibility/AccessibilityUserState;
 
@@ -405,7 +434,7 @@
 
     goto :goto_4
 
-    :cond_9
+    :cond_a
     :goto_3
     monitor-exit v6
 
@@ -418,14 +447,14 @@
 
     throw p0
 
-    :cond_a
+    :cond_b
     const-string/jumbo v6, "android.intent.action.USER_REMOVED"
 
     invoke-virtual {v6, p1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
 
     move-result v6
 
-    if-eqz v6, :cond_b
+    if-eqz v6, :cond_c
 
     iget-object p0, p0, Lcom/android/server/accessibility/AccessibilityManagerService$2;->this$0:Lcom/android/server/accessibility/AccessibilityManagerService;
 
@@ -439,14 +468,14 @@
 
     goto/16 :goto_c
 
-    :cond_b
+    :cond_c
     const-string/jumbo v6, "android.os.action.SETTING_RESTORED"
 
     invoke-virtual {v6, p1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
 
     move-result p1
 
-    if-eqz p1, :cond_1b
+    if-eqz p1, :cond_1c
 
     const-string/jumbo p1, "setting_name"
 
@@ -454,11 +483,11 @@
 
     move-result-object p1
 
-    if-nez p1, :cond_c
+    if-nez p1, :cond_d
 
     goto/16 :goto_c
 
-    :cond_c
+    :cond_d
     const-string/jumbo v6, "previous_value"
 
     invoke-virtual {p2, v6}, Landroid/content/Intent;->getStringExtra(Ljava/lang/String;)Ljava/lang/String;
@@ -499,11 +528,11 @@
 
     move-result v0
 
-    if-nez v0, :cond_d
+    if-nez v0, :cond_e
 
     goto :goto_5
 
-    :cond_d
+    :cond_e
     const/4 v0, 0x5
 
     goto :goto_6
@@ -515,11 +544,11 @@
 
     move-result v0
 
-    if-nez v0, :cond_e
+    if-nez v0, :cond_f
 
     goto :goto_5
 
-    :cond_e
+    :cond_f
     move v0, v3
 
     goto :goto_6
@@ -531,7 +560,7 @@
 
     move-result v9
 
-    if-nez v9, :cond_12
+    if-nez v9, :cond_13
 
     goto :goto_5
 
@@ -542,11 +571,11 @@
 
     move-result v0
 
-    if-nez v0, :cond_f
+    if-nez v0, :cond_10
 
     goto :goto_5
 
-    :cond_f
+    :cond_10
     move v0, v2
 
     goto :goto_6
@@ -558,11 +587,11 @@
 
     move-result v0
 
-    if-nez v0, :cond_10
+    if-nez v0, :cond_11
 
     goto :goto_5
 
-    :cond_10
+    :cond_11
     move v0, v5
 
     goto :goto_6
@@ -574,14 +603,14 @@
 
     move-result v0
 
-    if-nez v0, :cond_11
+    if-nez v0, :cond_12
 
     goto :goto_5
 
-    :cond_11
+    :cond_12
     move v0, v4
 
-    :cond_12
+    :cond_13
     :goto_6
     packed-switch v0, :pswitch_data_1
 
@@ -652,7 +681,7 @@
 
     and-int/lit8 v1, p1, 0xc
 
-    if-nez v1, :cond_1a
+    if-nez v1, :cond_1b
 
     iget-object v1, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mLock:Ljava/lang/Object;
 
@@ -663,7 +692,7 @@
 
     move-result-object v6
 
-    if-ne p1, v2, :cond_13
+    if-ne p1, v2, :cond_14
 
     new-instance v8, Landroid/util/ArraySet;
 
@@ -684,13 +713,13 @@
 
     goto/16 :goto_b
 
-    :cond_13
+    :cond_14
     invoke-virtual {v6, p1}, Lcom/android/server/accessibility/AccessibilityUserState;->getShortcutTargetsLocked(I)Ljava/util/LinkedHashSet;
 
     move-result-object v8
 
     :goto_7
-    if-ne p1, v2, :cond_18
+    if-ne p1, v2, :cond_19
 
     iget-object v2, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
 
@@ -704,19 +733,19 @@
 
     move-result v9
 
-    if-eqz v9, :cond_14
+    if-eqz v9, :cond_15
 
     const/4 v9, 0x0
 
     goto :goto_8
 
-    :cond_14
+    :cond_15
     invoke-static {v2}, Landroid/content/ComponentName;->unflattenFromString(Ljava/lang/String;)Landroid/content/ComponentName;
 
     move-result-object v9
 
     :goto_8
-    if-eqz v9, :cond_15
+    if-eqz v9, :cond_16
 
     invoke-interface {v8}, Ljava/util/Set;->stream()Ljava/util/stream/Stream;
 
@@ -738,13 +767,13 @@
 
     move-result v10
 
-    if-nez v10, :cond_15
+    if-nez v10, :cond_16
 
     move v10, v5
 
     goto :goto_9
 
-    :cond_15
+    :cond_16
     move v10, v4
 
     :goto_9
@@ -754,9 +783,9 @@
 
     invoke-virtual {p0, v7, v11, v8, v5}, Lcom/android/server/accessibility/AccessibilityManagerService;->readColonDelimitedStringToSet(Ljava/lang/String;Ljava/util/function/Function;Ljava/util/Set;Z)V
 
-    if-eqz v10, :cond_17
+    if-eqz v10, :cond_18
 
-    if-eqz v9, :cond_16
+    if-eqz v9, :cond_17
 
     invoke-interface {v8}, Ljava/util/Set;->stream()Ljava/util/stream/Stream;
 
@@ -778,17 +807,17 @@
 
     move-result v3
 
-    if-eqz v3, :cond_16
+    if-eqz v3, :cond_17
 
     move v3, v5
 
     goto :goto_a
 
-    :cond_16
+    :cond_17
     move v3, v4
 
     :goto_a
-    if-eqz v3, :cond_17
+    if-eqz v3, :cond_18
 
     const-string v3, "AccessibilityManagerService"
 
@@ -812,25 +841,25 @@
 
     invoke-interface {v8, p2}, Ljava/util/Set;->removeIf(Ljava/util/function/Predicate;)Z
 
-    :cond_17
+    :cond_18
     invoke-interface {v8}, Ljava/util/Set;->isEmpty()Z
 
     move-result p2
 
-    if-eqz p2, :cond_19
+    if-eqz p2, :cond_1a
 
     monitor-exit v1
 
     goto :goto_c
 
-    :cond_18
+    :cond_19
     new-instance p2, Lcom/android/server/accessibility/AccessibilityManagerService$$ExternalSyntheticLambda7;
 
     invoke-direct {p2, v5}, Lcom/android/server/accessibility/AccessibilityManagerService$$ExternalSyntheticLambda7;-><init>(I)V
 
     invoke-virtual {p0, v7, p2, v8, v5}, Lcom/android/server/accessibility/AccessibilityManagerService;->readColonDelimitedStringToSet(Ljava/lang/String;Ljava/util/function/Function;Ljava/util/Set;Z)V
 
-    :cond_19
+    :cond_1a
     invoke-virtual {v6, p1, v8}, Lcom/android/server/accessibility/AccessibilityUserState;->updateShortcutTargetsLocked(ILjava/util/Set;)Z
 
     invoke-static {p1}, Lcom/android/internal/accessibility/util/ShortcutUtils;->convertToKey(I)Ljava/lang/String;
@@ -860,7 +889,7 @@
 
     throw p0
 
-    :cond_1a
+    :cond_1b
     new-instance p0, Ljava/lang/IllegalArgumentException;
 
     const-string/jumbo p1, "Tap shortcuts are not supported."
@@ -869,7 +898,7 @@
 
     throw p0
 
-    :cond_1b
+    :cond_1c
     :goto_c
     return-void
 
diff --git a/smali/com/android/server/accessibility/AccessibilityManagerService.smali b/smali/com/android/server/accessibility/AccessibilityManagerService.smali
index e0f11503..3e8fa89d 100644
--- a/smali/com/android/server/accessibility/AccessibilityManagerService.smali
+++ b/smali/com/android/server/accessibility/AccessibilityManagerService.smali
@@ -1026,6 +1026,100 @@
     return-void
 .end method
 
+.method public static -$$Nest$msetColorAdjustment(Landroid/content/Context;Lcom/android/server/accessibility/AccessibilityManagerService;)V
+    .locals 6
+
+    invoke-virtual {p1}, Ljava/lang/Object;->getClass()Ljava/lang/Class;
+
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v0
+
+    const-string/jumbo v1, "color_blind"
+
+    const/4 v2, 0x0
+
+    const/4 v3, -0x2
+
+    invoke-static {v0, v1, v2, v3}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result v0
+
+    const/4 v1, 0x1
+
+    if-ne v0, v1, :cond_0
+
+    move v0, v1
+
+    goto :goto_0
+
+    :cond_0
+    move v0, v2
+
+    :goto_0
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object p0
+
+    const-string/jumbo v4, "color_adjustment_type"
+
+    const/4 v5, 0x2
+
+    invoke-static {p0, v4, v5, v3}, Landroid/provider/Settings$Secure;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result p0
+
+    if-nez p0, :cond_2
+
+    if-eqz v0, :cond_1
+
+    const/4 p0, 0x4
+
+    invoke-virtual {p1, p0, v1}, Lcom/android/server/accessibility/AccessibilityManagerService;->semSetMdnieAccessibilityMode(IZ)Z
+
+    return-void
+
+    :cond_1
+    invoke-virtual {p1, v1, v2}, Lcom/android/server/accessibility/AccessibilityManagerService;->semSetMdnieAccessibilityMode(IZ)Z
+
+    return-void
+
+    :cond_2
+    iget-object p0, p1, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {p0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object p0
+
+    const-string/jumbo v4, "color_blind_user_parameter"
+
+    const/4 v5, 0x0
+
+    invoke-static {p0, v4, v5, v3}, Landroid/provider/Settings$Secure;->getFloatForUser(Landroid/content/ContentResolver;Ljava/lang/String;FI)F
+
+    move-result p0
+
+    const/high16 v3, 0x41200000    # 10.0f
+
+    mul-float/2addr p0, v3
+
+    invoke-virtual {p1, v1, v2}, Lcom/android/server/accessibility/AccessibilityManagerService;->semSetMdnieAccessibilityMode(IZ)Z
+
+    :try_start_0
+    invoke-virtual {p1, v0, p0}, Lcom/android/server/accessibility/AccessibilityManagerService;->semSetColorBlind(ZF)Z
+    :try_end_0
+    .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
+
+    return-void
+
+    :catch_0
+    move-exception p0
+
+    invoke-virtual {p0}, Landroid/os/RemoteException;->printStackTrace()V
+
+    return-void
+.end method
+
 .method static constructor <clinit>()V
     .locals 2
 
@@ -17481,15 +17575,15 @@
 .end method
 
 .method public final semToggleDarkScreenMode()V
-    .locals 4
+    .locals 7
 
     invoke-virtual {p0}, Landroid/view/accessibility/IAccessibilityManager$Stub;->semToggleDarkScreenMode_enforcePermission()V
 
-    const-string v0, "AccessibilityManagerService"
+    const-string/jumbo v0, "semToggleDarkScreenMode()"
 
-    const-string/jumbo v1, "semToggleDarkScreenMode()"
+    const-string v1, "AccessibilityManagerService"
 
-    invoke-static {v0, v1}, Landroid/util/Log;->i(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v1, v0}, Landroid/util/Log;->i(Ljava/lang/String;Ljava/lang/String;)I
 
     invoke-virtual {p0}, Lcom/android/server/accessibility/AccessibilityManagerService;->isScreenReaderEnabled()Z
 
@@ -17501,88 +17595,200 @@
 
     if-nez v0, :cond_0
 
-    return-void
+    goto/16 :goto_2
 
     :cond_0
     iget-boolean v0, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mCurtainModeIsRunning:Z
 
-    xor-int/lit8 v0, v0, 0x1
+    const/4 v2, 0x1
+
+    xor-int/2addr v0, v2
 
     iput-boolean v0, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mCurtainModeIsRunning:Z
 
     iget-object v0, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
 
-    const v1, 0x1040da2
+    const v3, 0x1040da2
 
-    invoke-virtual {v0, v1}, Landroid/content/Context;->getString(I)Ljava/lang/String;
+    invoke-virtual {v0, v3}, Landroid/content/Context;->getString(I)Ljava/lang/String;
 
     move-result-object v0
 
-    iget-boolean v1, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mCurtainModeIsRunning:Z
+    iget-boolean v3, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mCurtainModeIsRunning:Z
 
-    if-eqz v1, :cond_1
+    if-eqz v3, :cond_1
 
-    iget-object v1, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
+    iget-object v3, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
 
-    const v2, 0x1040da1
+    const v4, 0x1040da1
 
     filled-new-array {v0}, [Ljava/lang/Object;
 
     move-result-object v0
 
-    invoke-virtual {v1, v2, v0}, Landroid/content/Context;->getString(I[Ljava/lang/Object;)Ljava/lang/String;
+    invoke-virtual {v3, v4, v0}, Landroid/content/Context;->getString(I[Ljava/lang/Object;)Ljava/lang/String;
 
     move-result-object v0
 
     goto :goto_0
 
     :cond_1
-    iget-object v1, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
+    iget-object v3, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
 
-    const v2, 0x1040da0
+    const v4, 0x1040da0
 
     filled-new-array {v0}, [Ljava/lang/Object;
 
     move-result-object v0
 
-    invoke-virtual {v1, v2, v0}, Landroid/content/Context;->getString(I[Ljava/lang/Object;)Ljava/lang/String;
+    invoke-virtual {v3, v4, v0}, Landroid/content/Context;->getString(I[Ljava/lang/Object;)Ljava/lang/String;
 
     move-result-object v0
 
     :goto_0
+    iget-object v3, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
+
+    invoke-static {v3}, Landroid/view/accessibility/AccessibilityManager;->getInstance(Landroid/content/Context;)Landroid/view/accessibility/AccessibilityManager;
+
+    move-result-object v3
+
+    const/16 v4, 0x20
+
+    invoke-static {v4}, Landroid/view/accessibility/AccessibilityEvent;->obtain(I)Landroid/view/accessibility/AccessibilityEvent;
+
+    move-result-object v4
+
+    invoke-virtual {v4}, Landroid/view/accessibility/AccessibilityEvent;->getText()Ljava/util/List;
+
+    move-result-object v5
+
+    invoke-interface {v5, v0}, Ljava/util/List;->add(Ljava/lang/Object;)Z
+
+    if-eqz v3, :cond_2
+
+    invoke-virtual {v3, v4}, Landroid/view/accessibility/AccessibilityManager;->sendAccessibilityEvent(Landroid/view/accessibility/AccessibilityEvent;)V
+
+    :cond_2
+    iget-object v0, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
+
+    const-string/jumbo v3, "mDNIe"
+
+    invoke-virtual {v0, v3}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+
+    move-result-object v0
+
+    check-cast v0, Lcom/samsung/android/hardware/display/SemMdnieManager;
+
+    if-nez v0, :cond_3
+
+    const-string/jumbo p0, "SemMdnieManager is null."
+
+    invoke-static {v1, p0}, Landroid/util/Log;->w(Ljava/lang/String;Ljava/lang/String;)I
+
+    return-void
+
+    :cond_3
+    iget-boolean v1, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mCurtainModeIsRunning:Z
+
+    invoke-virtual {v0, v1}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setmDNIeScreenCurtain(Z)Z
+
+    iget-boolean v1, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mCurtainModeIsRunning:Z
+
+    if-nez v1, :cond_8
+
     iget-object v1, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
 
-    invoke-static {v1}, Landroid/view/accessibility/AccessibilityManager;->getInstance(Landroid/content/Context;)Landroid/view/accessibility/AccessibilityManager;
+    invoke-virtual {v1}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
 
     move-result-object v1
 
-    const/16 v2, 0x20
+    const-string/jumbo v3, "color_blind"
 
-    invoke-static {v2}, Landroid/view/accessibility/AccessibilityEvent;->obtain(I)Landroid/view/accessibility/AccessibilityEvent;
+    const/4 v4, 0x0
 
-    move-result-object v2
+    const/4 v5, -0x2
+
+    invoke-static {v1, v3, v4, v5}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result v1
+
+    if-ne v1, v2, :cond_4
+
+    move v1, v2
+
+    goto :goto_1
+
+    :cond_4
+    move v1, v4
+
+    :goto_1
+    iget-object v3, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
 
-    invoke-virtual {v2}, Landroid/view/accessibility/AccessibilityEvent;->getText()Ljava/util/List;
+    invoke-virtual {v3}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
 
     move-result-object v3
 
-    invoke-interface {v3, v0}, Ljava/util/List;->add(Ljava/lang/Object;)Z
+    const-string/jumbo v6, "greyscale_mode"
 
-    if-eqz v1, :cond_2
+    invoke-static {v3, v6, v4, v5}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
 
-    invoke-virtual {v1, v2}, Landroid/view/accessibility/AccessibilityManager;->sendAccessibilityEvent(Landroid/view/accessibility/AccessibilityEvent;)V
+    move-result v3
 
-    :cond_2
-    iget-object p0, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
+    if-ne v3, v2, :cond_5
 
-    const-string/jumbo v0, "mDNIe"
+    move v4, v2
 
-    invoke-virtual {p0, v0}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+    :cond_5
+    iget-object v3, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
 
-    move-result-object p0
+    invoke-static {v3}, Lcom/samsung/android/emergencymode/SemEmergencyManager;->isEmergencyMode(Landroid/content/Context;)Z
 
-    check-cast p0, Lcom/samsung/android/hardware/display/SemMdnieManager;
+    move-result v3
+
+    if-eqz v3, :cond_6
+
+    goto :goto_2
+
+    :cond_6
+    if-eqz v4, :cond_7
 
+    const/4 p0, 0x4
+
+    invoke-virtual {v0, p0, v2}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setmDNIeAccessibilityMode(IZ)Z
+
+    return-void
+
+    :cond_7
+    if-eqz v1, :cond_8
+
+    :try_start_0
+    iget-object v0, p0, Lcom/android/server/accessibility/AccessibilityManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v0
+
+    const-string/jumbo v1, "color_blind_user_parameter"
+
+    const/4 v3, 0x0
+
+    invoke-static {v0, v1, v3, v5}, Landroid/provider/Settings$Secure;->getFloatForUser(Landroid/content/ContentResolver;Ljava/lang/String;FI)F
+
+    move-result v0
+
+    invoke-virtual {p0, v2, v0}, Lcom/android/server/accessibility/AccessibilityManagerService;->semSetColorBlind(ZF)Z
+    :try_end_0
+    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_0} :catch_0
+
+    return-void
+
+    :catch_0
+    move-exception p0
+
+    invoke-virtual {p0}, Ljava/lang/Exception;->printStackTrace()V
+
+    :cond_8
+    :goto_2
     return-void
 .end method
 
diff --git a/smali_classes2/com/samsung/android/displaysolution/EyeComfortSolutionService.smali b/smali_classes2/com/samsung/android/displaysolution/EyeComfortSolutionService.smali
index 46a9b3a8..940f5f3b 100644
--- a/smali_classes2/com/samsung/android/displaysolution/EyeComfortSolutionService.smali
+++ b/smali_classes2/com/samsung/android/displaysolution/EyeComfortSolutionService.smali
@@ -66,6 +66,8 @@
 
 .field public mDisplayAiqeManager:Lcom/samsung/android/displayaiqe/DisplayAiqeManager;
 
+.field public final mEnvironmentAdaptiveDisplaySupported:Z
+
 .field public final mHandler:Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ECSControlHandler;
 
 .field public mLastBoprBlueLightFilterIndex:I
@@ -458,412 +460,418 @@
 .end method
 
 .method public constructor <init>(Landroid/content/Context;)V
-    .locals 14
+    .locals 16
 
-    invoke-direct {p0}, Ljava/lang/Object;-><init>()V
+    move-object/from16 v0, p0
 
-    const/4 v0, 0x0
+    invoke-direct {v0}, Ljava/lang/Object;-><init>()V
 
-    iput-object v0, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mPrevmDNIeMode:Ljava/lang/String;
+    const/4 v1, 0x0
 
-    const-string/jumbo v1, "eng"
+    iput-object v1, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mPrevmDNIeMode:Ljava/lang/String;
 
-    sget-object v2, Landroid/os/Build;->TYPE:Ljava/lang/String;
+    const-string/jumbo v2, "eng"
 
-    invoke-virtual {v1, v2}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+    sget-object v3, Landroid/os/Build;->TYPE:Ljava/lang/String;
 
-    const/16 v1, 0xfa0
+    invoke-virtual {v2, v3}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
 
-    iput v1, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->GET_SYSTEM_SERVICES_MILLIS:I
+    const/16 v2, 0xfa0
 
-    const/16 v2, 0x2710
+    iput v2, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->GET_SYSTEM_SERVICES_MILLIS:I
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->ACTION_GET_BOPR_VALUE_DEBOUNCE_MILLIS:I
+    const/16 v3, 0x2710
 
-    const/4 v2, 0x0
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->ACTION_GET_BOPR_VALUE_DEBOUNCE_MILLIS:I
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->BOPR_MAX_VALUE:I
+    const/4 v3, 0x0
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->bopr_cumulative_count:I
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->BOPR_MAX_VALUE:I
 
-    const/4 v3, 0x4
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->bopr_cumulative_count:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mScreenModeSetting:I
+    const/4 v4, 0x4
 
-    const/4 v3, -0x1
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mScreenModeSetting:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mPrevClutValue:I
+    const/4 v4, -0x1
 
-    const/high16 v4, 0x3f800000    # 1.0f
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mPrevClutValue:I
 
-    iput v4, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->app_weighting_factor:F
+    const/high16 v5, 0x3f800000    # 1.0f
 
-    const/4 v4, 0x0
+    iput v5, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->app_weighting_factor:F
 
-    iput v4, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->cal_value_sum:F
+    const/4 v5, 0x0
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->prevTotalStep:I
+    iput v5, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->cal_value_sum:F
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->BOPR_VALUE_STEP:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->prevTotalStep:I
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mLastDayBlueLightFilterIndex:I
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->BOPR_VALUE_STEP:I
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mLastBoprBlueLightFilterIndex:I
+    iput v3, v0, Lcom/s97557293amsung/android/displaysolution/EyeComfortSolutionService;->mLastDayBlueLightFilterIndex:I
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mLastTotalBlueLightFilterIndex:I
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mLastBoprBlueLightFilterIndex:I
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNightDimFontConfigValue:I
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mLastTotalBlueLightFilterIndex:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNightDimFontConfigValuePrev:I
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNightDimFontConfigValue:I
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlfIndexEadOffset:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNightDimFontConfigValuePrev:I
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->defaultBedTime:I
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlfIndexEadOffset:I
 
-    const/16 v4, 0x168
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->defaultBedTime:I
 
-    iput v4, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->defaultWakeupTime:I
+    const/16 v5, 0x168
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_sunday:I
+    iput v5, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->defaultWakeupTime:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_monday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_sunday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_tuesday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_monday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_wednesday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_tuesday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_thursday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_wednesday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_friday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_thursday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_saturday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_friday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_sunday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBedtime_saturday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_monday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_sunday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_tuesday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_monday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_wednesday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_tuesday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_thursday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_wednesday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_friday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_thursday:I
 
-    iput v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_saturday:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_friday:I
 
-    iput v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNaturalModeVersion:I
+    iput v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mWakeupTime_saturday:I
 
-    iput-object v0, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBoprSensor:Landroid/hardware/Sensor;
+    iput v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNaturalModeVersion:I
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mSupportAPmDNIe:Z
+    iput-object v1, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBoprSensor:Landroid/hardware/Sensor;
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mScreenOn:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mSupportAPmDNIe:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterModeEnabled:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mScreenOn:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterAdaptiveModeEnabled:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterModeEnabled:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNightDimModeEnabled:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterAdaptiveModeEnabled:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mDefaultThemeEnabled:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNightDimModeEnabled:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mCurrentStateSleep:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mDefaultThemeEnabled:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mCurrentStateWakeup:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mCurrentStateSleep:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterEnableTime:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mCurrentStateWakeup:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mAdaptiveBlueLightFilterSupported:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterEnableTime:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mColorOnPixelRatioSupported:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mAdaptiveBlueLightFilterSupported:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterScheduledTime:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mColorOnPixelRatioSupported:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterCustomAlwaysOn:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterScheduledTime:Z
 
-    iput-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNaturalGammaScreenModeSupported:Z
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlueLightFilterCustomAlwaysOn:Z
 
-    new-instance v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$1;
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mEnvironmentAdaptiveDisplaySupported:Z
 
-    invoke-direct {v0, p0}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$1;-><init>(Lcom/samsung/android/displaysolution/EyeComfortSolutionService;)V
+    iput-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNaturalGammaScreenModeSupported:Z
 
-    iput-object v0, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBoprSensorListener:Lcom/samsung/android/displaysolution/EyeComfortSolutionService$1;
+    new-instance v1, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$1;
 
-    iput-object p1, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mContext:Landroid/content/Context;
+    invoke-direct {v1, v0}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$1;-><init>(Lcom/samsung/android/displaysolution/EyeComfortSolutionService;)V
 
-    const-string v0, "EyeComfortSolutionServiceThread"
+    iput-object v1, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBoprSensorListener:Lcom/samsung/android/displaysolution/EyeComfortSolutionService$1;
 
-    invoke-static {v0}, Lcom/android/server/KnoxCaptureInputFilter$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Landroid/os/HandlerThread;
+    move-object/from16 v5, p1
 
-    move-result-object v0
+    iput-object v5, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mContext:Landroid/content/Context;
 
-    new-instance v10, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ECSControlHandler;
+    const-string v1, "EyeComfortSolutionServiceThread"
 
-    invoke-virtual {v0}, Landroid/os/HandlerThread;->getLooper()Landroid/os/Looper;
+    invoke-static {v1}, Lcom/android/server/KnoxCaptureInputFilter$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Landroid/os/HandlerThread;
 
-    move-result-object v0
+    move-result-object v1
 
-    invoke-direct {v10, p0, v0}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ECSControlHandler;-><init>(Lcom/samsung/android/displaysolution/EyeComfortSolutionService;Landroid/os/Looper;)V
+    new-instance v11, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ECSControlHandler;
 
-    iput-object v10, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mHandler:Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ECSControlHandler;
+    invoke-virtual {v1}, Landroid/os/HandlerThread;->getLooper()Landroid/os/Looper;
 
-    invoke-virtual {p1}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
+    move-result-object v1
 
-    move-result-object v0
+    invoke-direct {v11, v0, v1}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ECSControlHandler;-><init>(Lcom/samsung/android/displaysolution/EyeComfortSolutionService;Landroid/os/Looper;)V
 
-    const v5, 0x11101b0
+    iput-object v11, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mHandler:Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ECSControlHandler;
 
-    invoke-virtual {v0, v5}, Landroid/content/res/Resources;->getBoolean(I)Z
+    invoke-virtual {v5}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
 
-    move-result v0
+    move-result-object v1
 
-    invoke-virtual {p1}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
+    const v6, 0x11101b0
 
-    move-result-object v5
+    invoke-virtual {v1, v6}, Landroid/content/res/Resources;->getBoolean(I)Z
 
-    const v6, 0x10e0020
+    move-result v1
 
-    invoke-virtual {v5, v6}, Landroid/content/res/Resources;->getInteger(I)I
+    invoke-virtual {v5}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
 
-    move-result v5
+    move-result-object v6
 
-    iput v5, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->BOPR_MAX_VALUE:I
+    const v7, 0x10e0020
 
-    const-string v11, "EyeComfortSolutionService"
+    invoke-virtual {v6, v7}, Landroid/content/res/Resources;->getInteger(I)I
 
-    const-string/jumbo v5, "mEnvironmentAdaptiveDisplaySupported false"
+    move-result v6
 
-    invoke-static {v11, v5}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+    iput v6, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->BOPR_MAX_VALUE:I
 
-    new-instance v5, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$SettingsObserver;
+    const/4 v12, 0x1
 
-    invoke-direct {v5, p0, v10}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$SettingsObserver;-><init>(Lcom/samsung/android/displaysolution/EyeComfortSolutionService;Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ECSControlHandler;)V
+    iput-boolean v12, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mEnvironmentAdaptiveDisplaySupported:Z
 
-    invoke-virtual {p1}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+    const-string v13, "EyeComfortSolutionService"
 
-    move-result-object v6
+    const-string/jumbo v6, "mEnvironmentAdaptiveDisplaySupported true"
 
-    invoke-static {}, Landroid/os/SystemClock;->uptimeMillis()J
+    invoke-static {v13, v6}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
-    move-result-wide v12
+    new-instance v6, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$SettingsObserver;
 
-    const-string/jumbo v7, "blue_light_filter"
+    invoke-direct {v6, v0, v11}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$SettingsObserver;-><init>(Lcom/samsung/android/displaysolution/EyeComfortSolutionService;Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ECSControlHandler;)V
 
-    invoke-static {v7}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
+    invoke-virtual {v5}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
 
     move-result-object v7
 
-    invoke-virtual {v6, v7, v2, v5, v3}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
+    invoke-static {}, Landroid/os/SystemClock;->uptimeMillis()J
 
-    const-string/jumbo v7, "blue_light_filter_night_dim"
+    move-result-wide v14
 
-    invoke-static {v7}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
+    const-string/jumbo v8, "blue_light_filter"
 
-    move-result-object v7
+    invoke-static {v8}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
 
-    invoke-virtual {v6, v7, v2, v5, v3}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
+    move-result-object v8
 
-    const-string/jumbo v7, "blue_light_filter_adaptive_mode"
+    invoke-virtual {v7, v8, v3, v6, v4}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
 
-    invoke-static {v7}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
+    const-string/jumbo v8, "blue_light_filter_night_dim"
 
-    move-result-object v7
+    invoke-static {v8}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
 
-    invoke-virtual {v6, v7, v2, v5, v3}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
+    move-result-object v8
 
-    const-string/jumbo v7, "current_sec_active_themepackage"
+    invoke-virtual {v7, v8, v3, v6, v4}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
 
-    invoke-static {v7}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
+    const-string/jumbo v8, "blue_light_filter_adaptive_mode"
 
-    move-result-object v7
+    invoke-static {v8}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
 
-    invoke-virtual {v6, v7, v2, v5, v3}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
+    move-result-object v8
 
-    const-string/jumbo v7, "blue_light_filter_type"
+    invoke-virtual {v7, v8, v3, v6, v4}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
 
-    invoke-static {v7}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
+    const-string/jumbo v8, "current_sec_active_themepackage"
 
-    move-result-object v7
+    invoke-static {v8}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
 
-    invoke-virtual {v6, v7, v2, v5, v3}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
+    move-result-object v8
 
-    const-string/jumbo v3, "screen_mode_setting"
+    invoke-virtual {v7, v8, v3, v6, v4}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
 
-    invoke-static {v3}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
+    const-string/jumbo v8, "blue_light_filter_type"
 
-    move-result-object v3
+    invoke-static {v8}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
+
+    move-result-object v8
 
-    const/4 v7, -0x2
+    invoke-virtual {v7, v8, v3, v6, v4}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
 
-    invoke-virtual {v6, v3, v2, v5, v7}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
+    const-string/jumbo v4, "screen_mode_setting"
 
-    new-instance v7, Landroid/content/IntentFilter;
+    invoke-static {v4}, Landroid/provider/Settings$System;->getUriFor(Ljava/lang/String;)Landroid/net/Uri;
 
-    invoke-direct {v7}, Landroid/content/IntentFilter;-><init>()V
+    move-result-object v4
 
-    const-string/jumbo v3, "android.intent.action.BOOT_COMPLETED"
+    const/4 v8, -0x2
 
-    const-string/jumbo v5, "android.intent.action.USER_SWITCHED"
+    invoke-virtual {v7, v4, v3, v6, v8}, Landroid/content/ContentResolver;->registerContentObserver(Landroid/net/Uri;ZLandroid/database/ContentObserver;I)V
 
-    const-string/jumbo v6, "android.intent.action.SCREEN_ON"
+    new-instance v8, Landroid/content/IntentFilter;
 
-    const-string/jumbo v8, "android.intent.action.SCREEN_OFF"
+    invoke-direct {v8}, Landroid/content/IntentFilter;-><init>()V
 
-    invoke-static {v7, v3, v5, v6, v8}, Lcom/android/server/am/ActivityManagerService$$ExternalSyntheticOutline0;->m(Landroid/content/IntentFilter;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
+    const-string/jumbo v4, "android.intent.action.BOOT_COMPLETED"
 
-    const-string/jumbo v3, "android.intent.action.USER_PRESENT"
+    const-string/jumbo v6, "android.intent.action.USER_SWITCHED"
 
-    const-string/jumbo v5, "android.intent.action.TIME_TICK"
+    const-string/jumbo v7, "android.intent.action.SCREEN_ON"
 
-    const-string/jumbo v6, "android.intent.action.TIME_SET"
+    const-string/jumbo v9, "android.intent.action.SCREEN_OFF"
 
-    const-string/jumbo v8, "android.intent.action.TIMEZONE_CHANGED"
+    invoke-static {v8, v4, v6, v7, v9}, Lcom/android/server/am/ActivityManagerService$$ExternalSyntheticOutline0;->m(Landroid/content/IntentFilter;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
 
-    invoke-static {v7, v3, v5, v6, v8}, Lcom/android/server/am/ActivityManagerService$$ExternalSyntheticOutline0;->m(Landroid/content/IntentFilter;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
+    const-string/jumbo v4, "android.intent.action.USER_PRESENT"
 
-    const-string/jumbo v3, "com.sec.android.intent.action.HQM_UPDATE_REQ"
+    const-string/jumbo v6, "android.intent.action.TIME_TICK"
 
-    invoke-virtual {v7, v3}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V
+    const-string/jumbo v7, "android.intent.action.TIME_SET"
 
-    new-instance v5, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ScreenWatchingReceiver;
+    const-string/jumbo v9, "android.intent.action.TIMEZONE_CHANGED"
 
-    invoke-direct {v5, p0}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ScreenWatchingReceiver;-><init>(Lcom/samsung/android/displaysolution/EyeComfortSolutionService;)V
+    invoke-static {v8, v4, v6, v7, v9}, Lcom/android/server/am/ActivityManagerService$$ExternalSyntheticOutline0;->m(Landroid/content/IntentFilter;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
 
-    sget-object v6, Landroid/os/UserHandle;->ALL:Landroid/os/UserHandle;
+    const-string/jumbo v4, "com.sec.android.intent.action.HQM_UPDATE_REQ"
 
-    const/4 v8, 0x0
+    invoke-virtual {v8, v4}, Landroid/content/IntentFilter;->addAction(Ljava/lang/String;)V
 
-    const/4 v9, 0x0
+    new-instance v6, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ScreenWatchingReceiver;
 
-    move-object v4, p1
+    invoke-direct {v6, v0}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService$ScreenWatchingReceiver;-><init>(Lcom/samsung/android/displaysolution/EyeComfortSolutionService;)V
 
-    invoke-virtual/range {v4 .. v9}, Landroid/content/Context;->registerReceiverAsUser(Landroid/content/BroadcastReceiver;Landroid/os/UserHandle;Landroid/content/IntentFilter;Ljava/lang/String;Landroid/os/Handler;)Landroid/content/Intent;
+    sget-object v7, Landroid/os/UserHandle;->ALL:Landroid/os/UserHandle;
 
-    const/4 v3, 0x1
+    const/4 v9, 0x0
 
-    invoke-virtual {v10, v3}, Landroid/os/Handler;->removeMessages(I)V
+    const/4 v10, 0x0
 
-    int-to-long v4, v1
+    invoke-virtual/range {v5 .. v10}, Landroid/content/Context;->registerReceiverAsUser(Landroid/content/BroadcastReceiver;Landroid/os/UserHandle;Landroid/content/IntentFilter;Ljava/lang/String;Landroid/os/Handler;)Landroid/content/Intent;
 
-    add-long/2addr v12, v4
+    invoke-virtual {v11, v12}, Landroid/os/Handler;->removeMessages(I)V
 
-    invoke-virtual {v10, v3, v12, v13}, Landroid/os/Handler;->sendEmptyMessageAtTime(IJ)Z
+    int-to-long v4, v2
+
+    add-long/2addr v14, v4
+
+    invoke-virtual {v11, v12, v14, v15}, Landroid/os/Handler;->sendEmptyMessageAtTime(IJ)Z
 
     invoke-static {}, Lcom/samsung/android/feature/SemFloatingFeature;->getInstance()Lcom/samsung/android/feature/SemFloatingFeature;
 
-    move-result-object v1
+    move-result-object v2
 
     const-string/jumbo v4, "SEC_FLOATING_FEATURE_LCD_SUPPORT_BLUE_FILTER_ADAPTIVE_MODE"
 
-    invoke-virtual {v1, v4, v2}, Lcom/samsung/android/feature/SemFloatingFeature;->getInt(Ljava/lang/String;I)I
+    invoke-virtual {v2, v4, v3}, Lcom/samsung/android/feature/SemFloatingFeature;->getInt(Ljava/lang/String;I)I
 
-    move-result v1
+    move-result v2
 
-    if-lez v1, :cond_0
+    if-lez v2, :cond_0
 
-    iput-boolean v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mAdaptiveBlueLightFilterSupported:Z
+    iput-boolean v12, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mAdaptiveBlueLightFilterSupported:Z
 
     :cond_0
     invoke-static {}, Lcom/samsung/android/feature/SemFloatingFeature;->getInstance()Lcom/samsung/android/feature/SemFloatingFeature;
 
-    move-result-object v1
+    move-result-object v2
 
-    invoke-virtual {v1, v4, v2}, Lcom/samsung/android/feature/SemFloatingFeature;->getInt(Ljava/lang/String;I)I
+    invoke-virtual {v2, v4, v3}, Lcom/samsung/android/feature/SemFloatingFeature;->getInt(Ljava/lang/String;I)I
 
-    move-result v1
+    move-result v2
 
-    if-ne v1, v3, :cond_1
+    if-ne v2, v12, :cond_1
 
-    iput-boolean v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mColorOnPixelRatioSupported:Z
+    iput-boolean v12, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mColorOnPixelRatioSupported:Z
 
     :cond_1
     invoke-static {}, Lcom/samsung/android/feature/SemFloatingFeature;->getInstance()Lcom/samsung/android/feature/SemFloatingFeature;
 
-    move-result-object v1
+    move-result-object v2
 
     const-string/jumbo v4, "SEC_FLOATING_FEATURE_LCD_CONFIG_NATURAL_MODE_TYPE"
 
-    invoke-virtual {v1, v4, v2}, Lcom/samsung/android/feature/SemFloatingFeature;->getInt(Ljava/lang/String;I)I
+    invoke-virtual {v2, v4, v3}, Lcom/samsung/android/feature/SemFloatingFeature;->getInt(Ljava/lang/String;I)I
 
-    move-result v1
+    move-result v2
 
-    if-lez v1, :cond_2
+    if-lez v2, :cond_2
 
-    iput-boolean v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNaturalGammaScreenModeSupported:Z
+    iput-boolean v12, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNaturalGammaScreenModeSupported:Z
 
     invoke-static {}, Lcom/samsung/android/feature/SemFloatingFeature;->getInstance()Lcom/samsung/android/feature/SemFloatingFeature;
 
-    move-result-object v1
+    move-result-object v2
 
-    invoke-virtual {v1, v4, v2}, Lcom/samsung/android/feature/SemFloatingFeature;->getInt(Ljava/lang/String;I)I
+    invoke-virtual {v2, v4, v3}, Lcom/samsung/android/feature/SemFloatingFeature;->getInt(Ljava/lang/String;I)I
 
-    move-result v1
+    move-result v2
 
-    iput v1, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNaturalModeVersion:I
+    iput v2, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mNaturalModeVersion:I
 
     :cond_2
     invoke-static {}, Lcom/samsung/android/feature/SemFloatingFeature;->getInstance()Lcom/samsung/android/feature/SemFloatingFeature;
 
-    move-result-object v1
+    move-result-object v2
 
-    const-string/jumbo v2, "SEC_FLOATING_FEATURE_LCD_CONFIG_HW_MDNIE"
+    const-string/jumbo v3, "SEC_FLOATING_FEATURE_LCD_CONFIG_HW_MDNIE"
 
-    invoke-virtual {v1, v2}, Lcom/samsung/android/feature/SemFloatingFeature;->getString(Ljava/lang/String;)Ljava/lang/String;
+    invoke-virtual {v2, v3}, Lcom/samsung/android/feature/SemFloatingFeature;->getString(Ljava/lang/String;)Ljava/lang/String;
 
-    move-result-object v1
+    move-result-object v2
 
-    const-string v2, "DDI"
+    const-string v3, "DDI"
 
-    invoke-virtual {v2, v1}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+    invoke-virtual {v3, v2}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
 
-    move-result v1
+    move-result v2
 
-    if-nez v1, :cond_3
+    if-nez v2, :cond_3
 
-    iput-boolean v3, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mSupportAPmDNIe:Z
+    iput-boolean v12, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mSupportAPmDNIe:Z
 
     :cond_3
-    new-instance v1, Ljava/lang/StringBuilder;
+    new-instance v2, Ljava/lang/StringBuilder;
 
-    const-string v2, "A_BLF : "
+    const-string v3, "A_BLF : "
 
-    invoke-direct {v1, v2}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+    invoke-direct {v2, v3}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
 
-    iget-boolean v2, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mAdaptiveBlueLightFilterSupported:Z
+    iget-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mAdaptiveBlueLightFilterSupported:Z
 
-    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    const-string v2, " , COPR_IP : "
+    const-string v3, " , COPR_IP : "
 
-    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    iget-boolean p0, p0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mColorOnPixelRatioSupported:Z
+    iget-boolean v0, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mColorOnPixelRatioSupported:Z
 
-    invoke-virtual {v1, p0}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    invoke-virtual {v2, v0}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
 
-    move-result-object p0
+    move-result-object v0
 
-    invoke-static {v11, p0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v13, v0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
-    const-string/jumbo p0, "sys.eyecomfortsolution.ecson"
+    const-string/jumbo v0, "sys.eyecomfortsolution.ecson"
 
-    const-string/jumbo v1, "false"
+    const-string/jumbo v2, "false"
 
-    invoke-static {p0, v1}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V
+    invoke-static {v0, v2}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V
 
-    if-eqz v0, :cond_4
+    if-eqz v1, :cond_4
 
-    const-string/jumbo v0, "true"
+    const-string/jumbo v1, "true"
 
-    invoke-static {p0, v0}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V
+    invoke-static {v0, v1}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V
 
     :cond_4
-    const-string p0, "EyeComfortSolutionService Enabled"
+    const-string v0, "EyeComfortSolutionService Enabled"
 
-    invoke-static {v11, p0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v13, v0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
     return-void
 .end method
@@ -1995,7 +2003,7 @@
 
     iget-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mAdaptiveBlueLightFilterSupported:Z
 
-    if-eqz v3, :cond_3
+    if-eqz v3, :cond_7
 
     iget-boolean v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mColorOnPixelRatioSupported:Z
 
@@ -2007,9 +2015,9 @@
 
     const-string v7, "BLF Adaptive Mode Enable : "
 
-    const-wide v8, 0x403638e38e38e38eL    # 22.22222222222222
+    const-string v8, "EyeComfortSolutionService"
 
-    const-string v10, "EyeComfortSolutionService"
+    const-wide v9, 0x403638e38e38e38eL    # 22.22222222222222
 
     const-wide v11, 0x40b7700000000000L    # 6000.0
 
@@ -2017,24 +2025,24 @@
 
     int-to-double v13, v1
 
-    mul-double/2addr v13, v8
+    mul-double/2addr v13, v9
 
     sub-double v13, v11, v13
 
     invoke-static {v1, v7, v6, v5, v2}, Lcom/android/server/accessibility/AccessibilityManagerService$$ExternalSyntheticOutline0;->m(ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Z)Ljava/lang/StringBuilder;
 
-    move-result-object v3
+    move-result-object v5
 
-    invoke-virtual {v3, v13, v14}, Ljava/lang/StringBuilder;->append(D)Ljava/lang/StringBuilder;
+    invoke-virtual {v5, v13, v14}, Ljava/lang/StringBuilder;->append(D)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v5, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
     iget v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlfIndexEadOffset:I
 
-    invoke-static {v3, v4, v10}, Lcom/android/server/RescueParty$RescuePartyObserver$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;ILjava/lang/String;)V
+    invoke-static {v5, v4, v8}, Lcom/android/server/RescueParty$RescuePartyObserver$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;ILjava/lang/String;)V
 
     :cond_0
-    move-wide v15, v8
+    move-wide v15, v9
 
     goto :goto_0
 
@@ -2043,58 +2051,62 @@
 
     const-wide v13, 0x404bc71c71c71c72L    # 55.55555555555556
 
-    move-wide v15, v8
+    move-wide v15, v9
 
-    int-to-double v8, v1
+    int-to-double v9, v1
 
-    mul-double/2addr v8, v13
+    mul-double/2addr v9, v13
 
-    sub-double v8, v11, v8
+    sub-double v9, v11, v9
 
     invoke-static {v1, v7, v6, v5, v2}, Lcom/android/server/accessibility/AccessibilityManagerService$$ExternalSyntheticOutline0;->m(ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;Z)Ljava/lang/StringBuilder;
 
-    move-result-object v3
+    move-result-object v5
 
-    invoke-virtual {v3, v8, v9}, Ljava/lang/StringBuilder;->append(D)Ljava/lang/StringBuilder;
+    invoke-virtual {v5, v9, v10}, Ljava/lang/StringBuilder;->append(D)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v5, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
     iget v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlfIndexEadOffset:I
 
-    invoke-static {v3, v4, v10}, Lcom/android/server/RescueParty$RescuePartyObserver$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;ILjava/lang/String;)V
+    invoke-static {v5, v4, v8}, Lcom/android/server/RescueParty$RescuePartyObserver$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;ILjava/lang/String;)V
 
     :goto_0
-    iget-object v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mContext:Landroid/content/Context;
+    iget-object v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mContext:Landroid/content/Context;
 
-    const-string/jumbo v4, "mDNIe"
+    const-string/jumbo v5, "mDNIe"
 
-    invoke-virtual {v3, v4}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+    invoke-virtual {v4, v5}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
 
-    move-result-object v3
+    move-result-object v4
 
-    check-cast v3, Lcom/samsung/android/hardware/display/SemMdnieManager;
+    check-cast v4, Lcom/samsung/android/hardware/display/SemMdnieManager;
 
-    iput-object v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mMdnieManager:Lcom/samsung/android/hardware/display/SemMdnieManager;
+    iput-object v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mMdnieManager:Lcom/samsung/android/hardware/display/SemMdnieManager;
 
-    new-instance v3, Ljava/lang/StringBuilder;
+    new-instance v4, Ljava/lang/StringBuilder;
 
-    const-string/jumbo v4, "mMdnieManager : "
+    const-string/jumbo v5, "mMdnieManager : "
 
-    invoke-direct {v3, v4}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+    invoke-direct {v4, v5}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
 
-    iget-object v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mMdnieManager:Lcom/samsung/android/hardware/display/SemMdnieManager;
+    iget-object v5, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mMdnieManager:Lcom/samsung/android/hardware/display/SemMdnieManager;
 
-    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
 
-    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
 
-    move-result-object v3
+    move-result-object v4
+
+    invoke-static {v8, v4}, Landroid/util/Slog;->v(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-boolean v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mEnvironmentAdaptiveDisplaySupported:Z
 
-    invoke-static {v10, v3}, Landroid/util/Slog;->v(Ljava/lang/String;Ljava/lang/String;)I
+    if-nez v4, :cond_2
 
     iget-object v3, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mMdnieManager:Lcom/samsung/android/hardware/display/SemMdnieManager;
 
-    if-eqz v3, :cond_2
+    if-eqz v3, :cond_6
 
     add-int/lit8 v4, v1, 0xb
 
@@ -2116,10 +2128,77 @@
 
     invoke-virtual {v3, v2, v4}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setNightMode(ZI)Z
 
+    goto :goto_3
+
     :cond_2
-    invoke-virtual/range {p0 .. p1}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->updateNightDimSettings(I)V
+    if-eqz v4, :cond_6
+
+    iget-object v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mMdnieManager:Lcom/samsung/android/hardware/display/SemMdnieManager;
+
+    if-eqz v4, :cond_6
+
+    if-eqz v3, :cond_3
+
+    const/16 v3, 0x65
+
+    goto :goto_1
 
     :cond_3
+    if-nez v3, :cond_4
+
+    const/16 v3, 0x2f
+
+    goto :goto_1
+
+    :cond_4
+    const/4 v3, 0x0
+
+    :goto_1
+    iget v5, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlfIndexEadOffset:I
+
+    add-int/2addr v5, v1
+
+    add-int/lit8 v5, v5, 0xb
+
+    if-le v5, v3, :cond_5
+
+    goto :goto_2
+
+    :cond_5
+    move v3, v5
+
+    :goto_2
+    invoke-virtual {v4, v3}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setNightModeStep(I)Z
+
+    iget-object v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mMdnieManager:Lcom/samsung/android/hardware/display/SemMdnieManager;
+
+    int-to-double v5, v1
+
+    mul-double/2addr v5, v15
+
+    sub-double/2addr v11, v5
+
+    iget v5, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mBlfIndexEadOffset:I
+
+    mul-int/lit8 v5, v5, 0x16
+
+    int-to-double v5, v5
+
+    sub-double/2addr v11, v5
+
+    double-to-int v5, v11
+
+    invoke-virtual {v4, v5}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setNightModeCct(I)Z
+
+    iget-object v4, v0, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->mMdnieManager:Lcom/samsung/android/hardware/display/SemMdnieManager;
+
+    invoke-virtual {v4, v2, v3}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setNightMode(ZI)Z
+
+    :cond_6
+    :goto_3
+    invoke-virtual/range {p0 .. p1}, Lcom/samsung/android/displaysolution/EyeComfortSolutionService;->updateNightDimSettings(I)V
+
+    :cond_7
     return-void
 .end method
 
diff --git a/smali_classes2/com/samsung/android/displaysolution/MdnieScenarioControlService.smali b/smali_classes2/com/samsung/android/displaysolution/MdnieScenarioControlService.smali
index 23d4a499..5bb3266f 100644
--- a/smali_classes2/com/samsung/android/displaysolution/MdnieScenarioControlService.smali
+++ b/smali_classes2/com/samsung/android/displaysolution/MdnieScenarioControlService.smali
@@ -2013,7 +2013,7 @@
     invoke-static {v4, v1, v7}, Lcom/android/server/RescueParty$RescuePartyObserver$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;ILjava/lang/String;)V
 
     :cond_4
-    const-string/jumbo v1, "mEnvironmentAdaptiveDisplaySupported false , mGlareReductionSupported : false"
+    const-string/jumbo v1, "mEnvironmentAdaptiveDisplaySupported true , mGlareReductionSupported : false"
 
     invoke-static {v7, v1}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
diff --git a/smali_classes2/com/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver.smali b/smali_classes2/com/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver.smali
index 869dd16f..6ccee256 100644
--- a/smali_classes2/com/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver.smali
+++ b/smali_classes2/com/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver.smali
@@ -103,7 +103,7 @@
 
     const-string/jumbo v7, "SemMdnieManagerService"
 
-    if-nez p1, :cond_c
+    if-nez p1, :cond_f
 
     iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
@@ -214,7 +214,7 @@
     :cond_3
     const/4 p2, 0x2
 
-    if-ne p1, p2, :cond_a
+    if-ne p1, p2, :cond_d
 
     iget-boolean p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mNightMode:Z
 
@@ -254,26 +254,156 @@
 
     move-result p1
 
-    if-eqz p1, :cond_6
+    if-eqz p1, :cond_9
 
     const-string p1, "EAD_ENABLED_URI onChange"
 
     invoke-static {v7, p1}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
+    iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
+
+    iget-boolean p2, p1, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mEnvironmentAdaptiveDisplaySupported:Z
+
+    if-eqz p2, :cond_d
+
+    iget-boolean p1, p1, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mSupportAPmDNIe:Z
+
+    const-string/jumbo p2, "ead_enabled"
+
+    if-eqz p1, :cond_6
+
+    new-instance p1, Ljava/lang/StringBuilder;
+
+    const-string v0, "AP setEnvironmentAdaptiveDisplayMode : "
+
+    invoke-direct {p1, v0}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    iget-object v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
+
+    iget-object v0, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v0
+
+    invoke-static {v0, p2, v6, v10}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result v0
+
+    invoke-virtual {p1, v0}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    invoke-virtual {p1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object p1
+
+    invoke-static {v7, p1}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
+
+    iget-object v0, p1, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mDisplayAiqeManager:Lcom/samsung/android/displayaiqe/DisplayAiqeManager;
+
+    iget-object p1, p1, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {p1}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object p1
+
+    invoke-static {p1, p2, v6, v10}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result p1
+
+    invoke-virtual {v0, p1}, Lcom/samsung/android/displayaiqe/DisplayAiqeManager;->setEnvironmentAdaptiveDisplayMode(I)Z
+
+    goto :goto_1
+
+    :cond_6
+    const-string p1, "/sys/class/mdnie/mdnie/adaptive_mode"
+
+    invoke-static {p1}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_7
+
+    iget-object v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
+
+    iget-object v0, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v0
+
+    invoke-static {v0, p2, v6, v10}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result v0
+
+    invoke-static {v0, p1}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
+
+    :cond_7
+    const-string p1, "/sys/class/mdnie/mdnie1/adaptive_mode"
+
+    invoke-static {p1}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_8
+
+    iget-object v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
+
+    iget-object v0, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v0
+
+    invoke-static {v0, p2, v6, v10}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result v0
+
+    invoke-static {v0, p1}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
+
+    :cond_8
+    new-instance p1, Ljava/lang/StringBuilder;
+
+    const-string v0, "DDI setEnvironmentAdaptiveDisplayMode : "
+
+    invoke-direct {p1, v0}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    iget-object v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
+
+    iget-object v0, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v0
+
+    invoke-static {v0, p2, v6, v10}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result p2
+
+    invoke-virtual {p1, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    invoke-virtual {p1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object p1
+
+    invoke-static {v7, p1}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+
+    :goto_1
     iget-object p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
-    invoke-virtual {p0}, Ljava/lang/Object;->getClass()Ljava/lang/Class;
+    invoke-static {p0}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->-$$Nest$msetting_is_changed(Lcom/samsung/android/hardware/display/SemMdnieManagerService;)V
 
     return-void
 
-    :cond_6
+    :cond_9
     iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->VIVIDNESS_STATE_URI:Landroid/net/Uri;
 
     invoke-virtual {p1, p2}, Landroid/net/Uri;->equals(Ljava/lang/Object;)Z
 
     move-result p1
 
-    if-eqz p1, :cond_b
+    if-eqz p1, :cond_e
 
     invoke-static {v7, v3}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
@@ -285,7 +415,7 @@
 
     move-result p1
 
-    if-lez p1, :cond_a
+    if-lez p1, :cond_d
 
     iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
@@ -295,7 +425,7 @@
 
     iget-boolean p1, p1, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mSupportAPmDNIe:Z
 
-    if-eqz p1, :cond_7
+    if-eqz p1, :cond_a
 
     new-instance p1, Ljava/lang/StringBuilder;
 
@@ -317,12 +447,12 @@
 
     return-void
 
-    :cond_7
+    :cond_a
     invoke-static {v5}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
 
     move-result p1
 
-    if-eqz p1, :cond_8
+    if-eqz p1, :cond_b
 
     iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
@@ -330,12 +460,12 @@
 
     invoke-static {p1, v5}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
 
-    :cond_8
+    :cond_b
     invoke-static {v4}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
 
     move-result p1
 
-    if-eqz p1, :cond_9
+    if-eqz p1, :cond_c
 
     iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
@@ -343,7 +473,7 @@
 
     invoke-static {p1, v4}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
 
-    :cond_9
+    :cond_c
     new-instance p1, Ljava/lang/StringBuilder;
 
     invoke-direct {p1, v0}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
@@ -354,24 +484,24 @@
 
     invoke-static {p1, p0, v7}, Lcom/android/server/RescueParty$RescuePartyObserver$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;ILjava/lang/String;)V
 
-    :cond_a
+    :cond_d
     return-void
 
-    :cond_b
+    :cond_e
     iget-object p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
     invoke-static {p0}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->-$$Nest$msetting_is_changed(Lcom/samsung/android/hardware/display/SemMdnieManagerService;)V
 
     return-void
 
-    :cond_c
+    :cond_f
     iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->VIVIDNESS_STATE_URI:Landroid/net/Uri;
 
     invoke-virtual {p1, p2}, Landroid/net/Uri;->equals(Ljava/lang/Object;)Z
 
     move-result p1
 
-    if-eqz p1, :cond_10
+    if-eqz p1, :cond_13
 
     invoke-static {v7, v3}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
@@ -383,7 +513,7 @@
 
     move-result p1
 
-    if-lez p1, :cond_10
+    if-lez p1, :cond_13
 
     iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
@@ -393,7 +523,7 @@
 
     iget-boolean p1, p1, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mSupportAPmDNIe:Z
 
-    if-eqz p1, :cond_d
+    if-eqz p1, :cond_10
 
     new-instance p1, Ljava/lang/StringBuilder;
 
@@ -413,14 +543,14 @@
 
     invoke-virtual {p2, p1}, Lcom/samsung/android/displayaiqe/DisplayAiqeManager;->setVividnessMode(I)Z
 
-    goto :goto_1
+    goto :goto_2
 
-    :cond_d
+    :cond_10
     invoke-static {v5}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
 
     move-result p1
 
-    if-eqz p1, :cond_e
+    if-eqz p1, :cond_11
 
     iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
@@ -428,12 +558,12 @@
 
     invoke-static {p1, v5}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
 
-    :cond_e
+    :cond_11
     invoke-static {v4}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
 
     move-result p1
 
-    if-eqz p1, :cond_f
+    if-eqz p1, :cond_12
 
     iget-object p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
@@ -441,7 +571,7 @@
 
     invoke-static {p1, v4}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
 
-    :cond_f
+    :cond_12
     new-instance p1, Ljava/lang/StringBuilder;
 
     invoke-direct {p1, v0}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
@@ -452,8 +582,8 @@
 
     invoke-static {p1, p2, v7}, Lcom/android/server/RescueParty$RescuePartyObserver$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;ILjava/lang/String;)V
 
-    :cond_10
-    :goto_1
+    :cond_13
+    :goto_2
     iget-object p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService$SettingsObserver;->this$0:Lcom/samsung/android/hardware/display/SemMdnieManagerService;
 
     invoke-static {p0}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->-$$Nest$msetting_is_changed(Lcom/samsung/android/hardware/display/SemMdnieManagerService;)V
diff --git a/smali_classes2/com/samsung/android/hardware/display/SemMdnieManagerService.smali b/smali_classes2/com/samsung/android/hardware/display/SemMdnieManagerService.smali
index fca23c58..4af3a1cf 100644
--- a/smali_classes2/com/samsung/android/hardware/display/SemMdnieManagerService.smali
+++ b/smali_classes2/com/samsung/android/hardware/display/SemMdnieManagerService.smali
@@ -36,6 +36,8 @@
 
 .field public final mContext:Landroid/content/Context;
 
+.field public mCurtainModeIsRunning:Z
+
 .field public final mDisplayAiqeManager:Lcom/samsung/android/displayaiqe/DisplayAiqeManager;
 
 .field public final mDisplayListener:Lcom/samsung/android/hardware/display/SemMdnieManagerService$1;
@@ -56,6 +58,8 @@
 
 .field public mEnvironmentAdaptiveDisplayEnabled:Z
 
+.field public final mEnvironmentAdaptiveDisplaySupported:Z
+
 .field public final mMdnieWhiteRGBSupported:Z
 
 .field public final mNaturalGammaScreenModeSupported:Z
@@ -66,6 +70,8 @@
 
 .field public final mNightDimSupported:Z
 
+.field public final mNightDisplayOffsetDelta:I
+
 .field public mNightMode:Z
 
 .field public mNightModeBlock:Z
@@ -98,6 +104,8 @@
 
 .field public mVividnessIndex:I
 
+.field public mWhiteBalancePresetIndex:I
+
 .field public mWorkBlueFilter:Z
 
 
@@ -243,6 +251,10 @@
 
     invoke-static {v9, v2, v5, v3}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
 
+    move-result v2
+
+    iput v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mWhiteBalancePresetIndex:I
+
     iget-object v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
 
     invoke-virtual {v2}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
@@ -803,6 +815,8 @@
 
     iput-boolean v5, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mNightModeBlock:Z
 
+    iput-boolean v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mCurtainModeIsRunning:Z
+
     iput-boolean v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mNightMode:Z
 
     iput-boolean v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mAdaptiveBlueLightFilterSupported:Z
@@ -827,6 +841,8 @@
 
     iput-boolean v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mEnvironmentAdaptiveDisplayEnabled:Z
 
+    iput-boolean v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mEnvironmentAdaptiveDisplaySupported:Z
+
     iput-boolean v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mUseAfterimageCompensationServiceConfig:Z
 
     iput-boolean v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mBlueLightFilterCustomAvailableTime:Z
@@ -849,6 +865,14 @@
 
     iput v2, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mNaturalModeVersion:I
 
+    const/4 v7, 0x2
+
+    iput v7, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mWhiteBalancePresetIndex:I
+
+    const/16 v7, 0x1f4
+
+    iput v7, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mNightDisplayOffsetDelta:I
+
     const/4 v7, -0x6
 
     const/16 v8, -0x14
@@ -1137,6 +1161,8 @@
 
     iput-boolean v4, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mMdnieWhiteRGBSupported:Z
 
+    iput-boolean v4, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mEnvironmentAdaptiveDisplaySupported:Z
+
     invoke-virtual {v1}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
 
     move-result-object v4
@@ -1613,7 +1639,15 @@
 
     invoke-virtual {v1, v3}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    const-string v3, ", S_EAD : false, SemMdnieMdnieManager AFC config : "
+    const-string v3, ", S_EAD : "
+
+    invoke-virtual {v1, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    iget-boolean v3, v0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mEnvironmentAdaptiveDisplaySupported:Z
+
+    invoke-virtual {v1, v3}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+
+    const-string v3, ", SemMdnieMdnieManager AFC config : "
 
     invoke-virtual {v1, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
@@ -1805,6 +1839,268 @@
     return p0
 .end method
 
+.method public static sysfsWrite_AdaptiveArray(Ljava/lang/String;[I)V
+    .locals 3
+
+    new-instance v0, Ljava/lang/StringBuilder;
+
+    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V
+
+    const/4 v1, 0x0
+
+    aget v1, p1, v1
+
+    invoke-static {v1}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    const-string v1, " "
+
+    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    const/4 v2, 0x1
+
+    aget v2, p1, v2
+
+    invoke-static {v2}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+
+    move-result-object v2
+
+    invoke-virtual {v0, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    const/4 v1, 0x2
+
+    aget p1, p1, v1
+
+    invoke-static {v0, p1}, Lcom/android/server/am/ProcessList$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;I)Ljava/lang/String;
+
+    move-result-object p1
+
+    const/4 v0, 0x0
+
+    :try_start_0
+    new-instance v1, Ljava/io/FileOutputStream;
+
+    new-instance v2, Ljava/io/File;
+
+    invoke-direct {v2, p0}, Ljava/io/File;-><init>(Ljava/lang/String;)V
+
+    invoke-direct {v1, v2}, Ljava/io/FileOutputStream;-><init>(Ljava/io/File;)V
+    :try_end_0
+    .catch Ljava/io/FileNotFoundException; {:try_start_0 .. :try_end_0} :catch_2
+    .catch Ljava/io/IOException; {:try_start_0 .. :try_end_0} :catch_1
+
+    :try_start_1
+    const-string/jumbo p0, "UTF-8"
+
+    invoke-static {p0}, Ljava/nio/charset/Charset;->forName(Ljava/lang/String;)Ljava/nio/charset/Charset;
+
+    move-result-object p0
+
+    invoke-virtual {p1, p0}, Ljava/lang/String;->getBytes(Ljava/nio/charset/Charset;)[B
+
+    move-result-object p0
+
+    invoke-virtual {v1, p0}, Ljava/io/FileOutputStream;->write([B)V
+
+    invoke-virtual {v1}, Ljava/io/FileOutputStream;->close()V
+    :try_end_1
+    .catch Ljava/io/IOException; {:try_start_1 .. :try_end_1} :catch_0
+
+    return-void
+
+    :catch_0
+    move-exception p0
+
+    move-object v0, v1
+
+    goto :goto_0
+
+    :catch_1
+    move-exception p0
+
+    goto :goto_0
+
+    :catch_2
+    move-exception p0
+
+    :try_start_2
+    invoke-virtual {p0}, Ljava/io/FileNotFoundException;->printStackTrace()V
+    :try_end_2
+    .catch Ljava/io/IOException; {:try_start_2 .. :try_end_2} :catch_1
+
+    goto :goto_1
+
+    :goto_0
+    invoke-virtual {p0}, Ljava/io/IOException;->printStackTrace()V
+
+    :try_start_3
+    invoke-virtual {v0}, Ljava/io/FileOutputStream;->close()V
+    :try_end_3
+    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_3} :catch_3
+
+    goto :goto_1
+
+    :catch_3
+    move-exception p0
+
+    invoke-virtual {p0}, Ljava/lang/Exception;->printStackTrace()V
+
+    :goto_1
+    return-void
+.end method
+
+.method public static sysfsWrite_CB(ILjava/lang/String;[I)Z
+    .locals 4
+
+    new-instance v0, Ljava/lang/StringBuilder;
+
+    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V
+
+    invoke-static {p0}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+
+    move-result-object p0
+
+    invoke-virtual {v0, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    const-string p0, " "
+
+    invoke-virtual {v0, p0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    const/4 v1, 0x0
+
+    aget v2, p2, v1
+
+    invoke-static {v2, v0, p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(ILjava/lang/StringBuilder;Ljava/lang/String;)V
+
+    const/4 v2, 0x1
+
+    aget v3, p2, v2
+
+    invoke-static {v3, v0, p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(ILjava/lang/StringBuilder;Ljava/lang/String;)V
+
+    const/4 v3, 0x2
+
+    aget v3, p2, v3
+
+    invoke-static {v3, v0, p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(ILjava/lang/StringBuilder;Ljava/lang/String;)V
+
+    const/4 v3, 0x3
+
+    aget v3, p2, v3
+
+    invoke-static {v3, v0, p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(ILjava/lang/StringBuilder;Ljava/lang/String;)V
+
+    const/4 v3, 0x4
+
+    aget v3, p2, v3
+
+    invoke-static {v3, v0, p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(ILjava/lang/StringBuilder;Ljava/lang/String;)V
+
+    const/4 v3, 0x5
+
+    aget v3, p2, v3
+
+    invoke-static {v3, v0, p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(ILjava/lang/StringBuilder;Ljava/lang/String;)V
+
+    const/4 v3, 0x6
+
+    aget v3, p2, v3
+
+    invoke-static {v3, v0, p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(ILjava/lang/StringBuilder;Ljava/lang/String;)V
+
+    const/4 v3, 0x7
+
+    aget v3, p2, v3
+
+    invoke-static {v3, v0, p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(ILjava/lang/StringBuilder;Ljava/lang/String;)V
+
+    const/16 p0, 0x8
+
+    aget p0, p2, p0
+
+    invoke-static {v0, p0}, Landroid/hardware/audio/common/V2_0/AudioChannelMask$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;I)Ljava/lang/String;
+
+    move-result-object p0
+
+    const/4 p2, 0x0
+
+    :try_start_0
+    new-instance v0, Ljava/io/FileOutputStream;
+
+    new-instance v3, Ljava/io/File;
+
+    invoke-direct {v3, p1}, Ljava/io/File;-><init>(Ljava/lang/String;)V
+
+    invoke-direct {v0, v3}, Ljava/io/FileOutputStream;-><init>(Ljava/io/File;)V
+    :try_end_0
+    .catch Ljava/io/FileNotFoundException; {:try_start_0 .. :try_end_0} :catch_2
+    .catch Ljava/io/IOException; {:try_start_0 .. :try_end_0} :catch_1
+
+    :try_start_1
+    const-string/jumbo p1, "UTF-8"
+
+    invoke-static {p1}, Ljava/nio/charset/Charset;->forName(Ljava/lang/String;)Ljava/nio/charset/Charset;
+
+    move-result-object p1
+
+    invoke-virtual {p0, p1}, Ljava/lang/String;->getBytes(Ljava/nio/charset/Charset;)[B
+
+    move-result-object p0
+
+    invoke-virtual {v0, p0}, Ljava/io/FileOutputStream;->write([B)V
+
+    invoke-virtual {v0}, Ljava/io/FileOutputStream;->close()V
+    :try_end_1
+    .catch Ljava/io/IOException; {:try_start_1 .. :try_end_1} :catch_0
+
+    return v2
+
+    :catch_0
+    move-exception p0
+
+    move-object p2, v0
+
+    goto :goto_0
+
+    :catch_1
+    move-exception p0
+
+    goto :goto_0
+
+    :catch_2
+    move-exception p0
+
+    :try_start_2
+    invoke-virtual {p0}, Ljava/io/FileNotFoundException;->printStackTrace()V
+    :try_end_2
+    .catch Ljava/io/IOException; {:try_start_2 .. :try_end_2} :catch_1
+
+    goto :goto_1
+
+    :goto_0
+    invoke-virtual {p0}, Ljava/io/IOException;->printStackTrace()V
+
+    :try_start_3
+    invoke-virtual {p2}, Ljava/io/FileOutputStream;->close()V
+    :try_end_3
+    .catch Ljava/lang/Exception; {:try_start_3 .. :try_end_3} :catch_3
+
+    goto :goto_1
+
+    :catch_3
+    move-exception p0
+
+    invoke-virtual {p0}, Ljava/lang/Exception;->printStackTrace()V
+
+    :goto_1
+    return v1
+.end method
+
 
 # virtual methods
 .method public final afpcDataApply()Z
@@ -2725,27 +3021,163 @@
 .end method
 
 .method public final setEadMode(II[I)V
-    .locals 0
-
-    return-void
-.end method
+    .locals 2
 
-.method public final setEadModeSub(II[I)V
-    .locals 0
+    iget-boolean p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mEnvironmentAdaptiveDisplaySupported:Z
 
-    return-void
-.end method
+    if-eqz p1, :cond_1
 
-.method public final setExtraDimMode(I)V
-    .locals 2
+    iget-boolean p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mSupportAPmDNIe:Z
 
-    iget-boolean v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mSupportAPmDNIe:Z
+    const-string v0, ")"
 
     const-string/jumbo v1, "SemMdnieManagerService"
 
-    if-eqz v0, :cond_0
+    if-eqz p1, :cond_0
 
-    const-string v0, "AP setExtraDimMode : "
+    iget-object p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mDisplayAiqeManager:Lcom/samsung/android/displayaiqe/DisplayAiqeManager;
+
+    invoke-virtual {p0, p2}, Lcom/samsung/android/displayaiqe/DisplayAiqeManager;->setEnvironmentAdaptiveDisplayLevel(I)Z
+
+    new-instance p0, Ljava/lang/StringBuilder;
+
+    const-string p1, "AP setEadMode : index("
+
+    invoke-direct {p0, p1}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    invoke-virtual {p0, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    invoke-virtual {p0, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-virtual {p0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object p0
+
+    invoke-static {v1, p0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+
+    return-void
+
+    :cond_0
+    const-string p0, "/sys/class/mdnie/mdnie/whiteRGB"
+
+    invoke-static {p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
+
+    move-result p1
+
+    if-eqz p1, :cond_1
+
+    invoke-static {p0, p3}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite_AdaptiveArray(Ljava/lang/String;[I)V
+
+    new-instance p0, Ljava/lang/StringBuilder;
+
+    const-string p1, "DDI setEadMode : arr("
+
+    invoke-direct {p0, p1}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    const/4 p1, 0x0
+
+    aget p1, p3, p1
+
+    invoke-virtual {p0, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    const-string p1, ","
+
+    invoke-virtual {p0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    const/4 p2, 0x1
+
+    aget p2, p3, p2
+
+    invoke-virtual {p0, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    invoke-virtual {p0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    const/4 p1, 0x2
+
+    aget p1, p3, p1
+
+    invoke-static {p1, v0, v1, p0}, Lcom/android/server/CustomizedBinderCallsStatsInternal$$ExternalSyntheticOutline0;->m(ILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)V
+
+    :cond_1
+    return-void
+.end method
+
+.method public final setEadModeSub(II[I)V
+    .locals 2
+
+    iget-boolean p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mEnvironmentAdaptiveDisplaySupported:Z
+
+    if-eqz p1, :cond_1
+
+    iget-boolean p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mSupportAPmDNIe:Z
+
+    const-string p1, ")"
+
+    const-string/jumbo v0, "SemMdnieManagerService"
+
+    if-eqz p0, :cond_0
+
+    const-string p0, "AP setEadModeSub : index("
+
+    invoke-static {p2, p0, p1, v0}, Lcom/android/server/BootReceiver$$ExternalSyntheticOutline0;->m(ILjava/lang/String;Ljava/lang/String;Ljava/lang/String;)V
+
+    return-void
+
+    :cond_0
+    const-string p0, "/sys/class/mdnie/mdnie1/whiteRGB"
+
+    invoke-static {p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
+
+    move-result p2
+
+    if-eqz p2, :cond_1
+
+    invoke-static {p0, p3}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite_AdaptiveArray(Ljava/lang/String;[I)V
+
+    new-instance p0, Ljava/lang/StringBuilder;
+
+    const-string p2, "DDI setEadModeSub : arr("
+
+    invoke-direct {p0, p2}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+
+    const/4 p2, 0x0
+
+    aget p2, p3, p2
+
+    invoke-virtual {p0, p2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    const-string p2, ","
+
+    invoke-virtual {p0, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    const/4 v1, 0x1
+
+    aget v1, p3, v1
+
+    invoke-virtual {p0, v1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+
+    invoke-virtual {p0, p2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    const/4 p2, 0x2
+
+    aget p2, p3, p2
+
+    invoke-static {p2, p1, v0, p0}, Lcom/android/server/CustomizedBinderCallsStatsInternal$$ExternalSyntheticOutline0;->m(ILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)V
+
+    :cond_1
+    return-void
+.end method
+
+.method public final setExtraDimMode(I)V
+    .locals 2
+
+    iget-boolean v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mSupportAPmDNIe:Z
+
+    const-string/jumbo v1, "SemMdnieManagerService"
+
+    if-eqz v0, :cond_0
+
+    const-string v0, "AP setExtraDimMode : "
 
     invoke-static {p1, v0, v1}, Lcom/android/server/HermesService$3$$ExternalSyntheticOutline0;->m(ILjava/lang/String;Ljava/lang/String;)V
 
@@ -3742,103 +4174,388 @@
 .end method
 
 .method public final setWhiteRGB(IIIIII)Z
-    .locals 1
+    .locals 7
 
-    const-string/jumbo p0, "setWhiteRGB("
+    const-string/jumbo v0, "setWhiteRGB("
 
-    const-string v0, ","
+    const-string v1, ","
 
-    invoke-static {p1, p2, p0, v0, v0}, Lcom/android/internal/util/jobs/ArrayUtils$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-static {p1, p2, v0, v1, v1}, Lcom/android/internal/util/jobs/ArrayUtils$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object p0
+    move-result-object v0
 
-    invoke-static {p3, p4, v0, v0, p0}, Lcom/android/server/ServiceKeeper$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)V
+    invoke-static {p3, p4, v1, v1, v0}, Lcom/android/server/ServiceKeeper$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)V
 
-    const-string p1, ")"
+    const-string v2, ")"
+
+    invoke-static {p5, p6, v1, v2, v0}, Lcom/android/server/am/BroadcastController$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)Ljava/lang/String;
 
-    invoke-static {p5, p6, v0, p1, p0}, Lcom/android/server/am/BroadcastController$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)Ljava/lang/String;
+    move-result-object v0
+
+    const-string/jumbo v3, "SemMdnieManagerService"
+
+    invoke-static {v3, v0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-boolean v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mEnvironmentAdaptiveDisplaySupported:Z
+
+    if-eqz v0, :cond_3
+
+    iget-boolean v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mEnvironmentAdaptiveDisplayEnabled:Z
+
+    if-eqz v0, :cond_3
+
+    iget-boolean v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mSupportAPmDNIe:Z
+
+    const-string v4, ") , Sub RGB offset ("
+
+    if-eqz v0, :cond_0
+
+    const-string v0, "AP setWhiteBalanceMode : Main RGB offset ("
+
+    invoke-static {p1, p2, v0, v1, v1}, Lcom/android/internal/util/jobs/ArrayUtils$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v0
+
+    invoke-static {p3, p4, v4, v1, v0}, Lcom/android/server/ServiceKeeper$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)V
+
+    invoke-static {p5, p6, v1, v2, v0}, Lcom/android/server/am/BroadcastController$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)Ljava/lang/String;
+
+    move-result-object v0
+
+    invoke-static {v3, v0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+
+    iget-object p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mDisplayAiqeManager:Lcom/samsung/android/displayaiqe/DisplayAiqeManager;
+
+    invoke-virtual/range {p0 .. p6}, Lcom/samsung/android/displayaiqe/DisplayAiqeManager;->setWhiteBalanceMode(IIIIII)Z
+
+    goto :goto_0
+
+    :cond_0
+    const-string p0, "/sys/class/mdnie/mdnie/whiteRGB"
+
+    invoke-static {p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
+
+    move-result v0
+
+    const-string v5, " "
+
+    if-eqz v0, :cond_1
+
+    new-instance v0, Ljava/lang/StringBuilder;
+
+    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V
+
+    invoke-static {p1}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+
+    move-result-object v6
+
+    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-static {p2}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+
+    move-result-object v6
+
+    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-static {p3}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+
+    move-result-object v6
+
+    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v0
+
+    invoke-static {p0, v0}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWriteSting(Ljava/lang/String;Ljava/lang/String;)Z
+
+    :cond_1
+    const-string p0, "/sys/class/mdnie/mdnie1/whiteRGB"
+
+    invoke-static {p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_2
+
+    new-instance v0, Ljava/lang/StringBuilder;
+
+    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V
+
+    invoke-static {p4}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+
+    move-result-object v6
+
+    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-static {p5}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+
+    move-result-object v6
+
+    invoke-virtual {v0, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-static {p6}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
+
+    move-result-object v5
+
+    invoke-virtual {v0, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v0
+
+    invoke-static {p0, v0}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWriteSting(Ljava/lang/String;Ljava/lang/String;)Z
+
+    :cond_2
+    const-string p0, "DDI setWhiteBalanceMode : Main RGB offset ("
+
+    invoke-static {p1, p2, p0, v1, v1}, Lcom/android/internal/util/jobs/ArrayUtils$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/String;)Ljava/lang/StringBuilder;
 
     move-result-object p0
 
-    const-string/jumbo p1, "SemMdnieManagerService"
+    invoke-static {p3, p4, v4, v1, p0}, Lcom/android/server/ServiceKeeper$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)V
+
+    invoke-static {p5, p6, v1, v2, p0}, Lcom/android/server/am/BroadcastController$$ExternalSyntheticOutline0;->m(IILjava/lang/String;Ljava/lang/String;Ljava/lang/StringBuilder;)Ljava/lang/String;
 
-    invoke-static {p1, p0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+    move-result-object p0
 
+    invoke-static {v3, p0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+
+    const/4 p0, 0x1
+
+    return p0
+
+    :cond_3
+    :goto_0
     const/4 p0, 0x0
 
     return p0
 .end method
 
 .method public final setmDNIeAccessibilityMode(IZ)Z
-    .locals 2
+    .locals 3
 
-    iget-object p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
+    iget-object v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
 
-    const-string/jumbo v0, "com.samsung.android.permission.CHANGE_DISPLAY_COLOR"
+    const-string/jumbo v1, "com.samsung.android.permission.CHANGE_DISPLAY_COLOR"
 
-    const-string/jumbo v1, "setmDNIeAccessibilityMode"
+    const-string/jumbo v2, "setmDNIeAccessibilityMode"
 
-    invoke-virtual {p0, v0, v1}, Landroid/content/Context;->enforceCallingOrSelfPermission(Ljava/lang/String;Ljava/lang/String;)V
+    invoke-virtual {v0, v1, v2}, Landroid/content/Context;->enforceCallingOrSelfPermission(Ljava/lang/String;Ljava/lang/String;)V
 
-    new-instance p0, Ljava/lang/StringBuilder;
+    new-instance v0, Ljava/lang/StringBuilder;
 
-    const-string/jumbo v0, "setmDNIeAccessibilityMode("
+    const-string/jumbo v1, "setmDNIeAccessibilityMode("
 
-    invoke-direct {p0, v0}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+    invoke-direct {v0, v1}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
 
-    invoke-virtual {p0, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
+    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;
 
-    const-string p1, ", "
+    const-string v1, ", "
 
-    invoke-virtual {p0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    invoke-virtual {p0, p2}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    invoke-virtual {v0, p2}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    const-string p1, ")"
+    const-string v1, ")"
 
-    invoke-virtual {p0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    invoke-virtual {p0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
 
-    move-result-object p0
+    move-result-object v0
 
-    const-string/jumbo p1, "SemMdnieManagerService"
+    const-string/jumbo v1, "SemMdnieManagerService"
+
+    invoke-static {v1, v0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
 
-    invoke-static {p1, p0}, Landroid/util/Slog;->i(Ljava/lang/String;Ljava/lang/String;)I
+    iget-boolean p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mCurtainModeIsRunning:Z
 
-    const/4 p0, 0x0
+    const/4 v0, 0x0
+
+    if-nez p0, :cond_6
+
+    const/16 p0, 0xa
+
+    if-eq p1, p0, :cond_5
+
+    const-string p0, "/sys/class/mdnie/mdnie1/accessibility"
+
+    invoke-static {p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
+
+    move-result v1
+
+    const-string v2, "/sys/class/mdnie/mdnie/accessibility"
+
+    if-eqz v1, :cond_3
+
+    if-eqz p2, :cond_0
+
+    move v1, p1
+
+    goto :goto_0
+
+    :cond_0
+    move v1, v0
+
+    :goto_0
+    invoke-static {v1, v2}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_2
+
+    if-eqz p2, :cond_1
+
+    goto :goto_1
+
+    :cond_1
+    move p1, v0
+
+    :goto_1
+    invoke-static {p1, p0}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
+
+    move-result p0
+
+    if-eqz p0, :cond_2
+
+    const/4 p0, 0x1
+
+    return p0
+
+    :cond_2
+    return v0
+
+    :cond_3
+    if-eqz p2, :cond_4
+
+    goto :goto_2
+
+    :cond_4
+    move p1, v0
+
+    :goto_2
+    invoke-static {p1, v2}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
+
+    move-result p0
 
     return p0
+
+    :cond_5
+    const-string p0, "/sys/class/backlight/panel/weakness_hbm_comp"
+
+    invoke-static {p2, p0}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
+
+    move-result p0
+
+    return p0
+
+    :cond_6
+    return v0
 .end method
 
 .method public final setmDNIeColorBlind(Z[I)Z
-    .locals 1
+    .locals 4
 
-    iget-object p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
+    iget-object v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
 
-    const-string/jumbo p2, "com.samsung.android.permission.CHANGE_DISPLAY_COLOR"
+    const-string/jumbo v1, "com.samsung.android.permission.CHANGE_DISPLAY_COLOR"
 
-    const-string/jumbo v0, "setmDNIeColorBlind"
+    const-string/jumbo v2, "setmDNIeColorBlind"
 
-    invoke-virtual {p0, p2, v0}, Landroid/content/Context;->enforceCallingOrSelfPermission(Ljava/lang/String;Ljava/lang/String;)V
+    invoke-virtual {v0, v1, v2}, Landroid/content/Context;->enforceCallingOrSelfPermission(Ljava/lang/String;Ljava/lang/String;)V
 
-    new-instance p0, Ljava/lang/StringBuilder;
+    new-instance v0, Ljava/lang/StringBuilder;
 
-    const-string/jumbo p2, "setmDNIeColorBlind ("
+    const-string/jumbo v1, "setmDNIeColorBlind ("
 
-    invoke-direct {p0, p2}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+    invoke-direct {v0, v1}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
 
-    invoke-virtual {p0, p1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    const-string p1, ")"
+    const-string v1, ")"
 
-    const-string/jumbo p2, "SemMdnieManagerService"
+    const-string/jumbo v2, "SemMdnieManagerService"
 
-    invoke-static {p0, p1, p2}, Lcom/android/server/DeviceIdleController$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;Ljava/lang/String;Ljava/lang/String;)V
+    invoke-static {v0, v1, v2}, Lcom/android/server/DeviceIdleController$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;Ljava/lang/String;Ljava/lang/String;)V
 
-    const/4 p0, 0x0
+    iget-boolean p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mCurtainModeIsRunning:Z
+
+    const/4 v0, 0x0
+
+    if-nez p0, :cond_5
+
+    const-string p0, "/sys/class/mdnie/mdnie1/accessibility"
+
+    invoke-static {p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
+
+    move-result v1
+
+    const-string v2, "/sys/class/mdnie/mdnie/accessibility"
+
+    const/4 v3, 0x2
+
+    if-eqz v1, :cond_3
+
+    if-eqz p1, :cond_0
+
+    move v1, v3
+
+    goto :goto_0
+
+    :cond_0
+    move v1, v0
+
+    :goto_0
+    invoke-static {v1, v2, p2}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite_CB(ILjava/lang/String;[I)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_2
+
+    if-eqz p1, :cond_1
+
+    goto :goto_1
+
+    :cond_1
+    move v3, v0
+
+    :goto_1
+    invoke-static {v3, p0, p2}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite_CB(ILjava/lang/String;[I)Z
+
+    move-result p0
+
+    if-eqz p0, :cond_2
+
+    const/4 p0, 0x1
 
     return p0
+
+    :cond_2
+    return v0
+
+    :cond_3
+    if-eqz p1, :cond_4
+
+    move v0, v3
+
+    :cond_4
+    invoke-static {v0, v2, p2}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite_CB(ILjava/lang/String;[I)Z
+
+    move-result p0
+
+    return p0
+
+    :cond_5
+    return v0
 .end method
 
 .method public final setmDNIeEmergencyMode(Z)Z
@@ -3912,59 +4629,102 @@
 .end method
 
 .method public final setmDNIeNegative(Z)Z
-    .locals 2
+    .locals 3
 
-    iget-object p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
+    iget-object v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
 
-    const-string/jumbo v0, "com.samsung.android.permission.CHANGE_DISPLAY_COLOR"
+    const-string/jumbo v1, "com.samsung.android.permission.CHANGE_DISPLAY_COLOR"
 
-    const-string/jumbo v1, "setmDNIeNegative"
+    const-string/jumbo v2, "setmDNIeNegative"
 
-    invoke-virtual {p0, v0, v1}, Landroid/content/Context;->enforceCallingOrSelfPermission(Ljava/lang/String;Ljava/lang/String;)V
+    invoke-virtual {v0, v1, v2}, Landroid/content/Context;->enforceCallingOrSelfPermission(Ljava/lang/String;Ljava/lang/String;)V
 
-    new-instance p0, Ljava/lang/StringBuilder;
+    new-instance v0, Ljava/lang/StringBuilder;
 
-    const-string/jumbo v0, "setmDNIeNegative ("
+    const-string/jumbo v1, "setmDNIeNegative ("
 
-    invoke-direct {p0, v0}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+    invoke-direct {v0, v1}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
 
-    invoke-virtual {p0, p1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    const-string p1, ")"
+    const-string v1, ")"
 
-    const-string/jumbo v0, "SemMdnieManagerService"
+    const-string/jumbo v2, "SemMdnieManagerService"
 
-    invoke-static {p0, p1, v0}, Lcom/android/server/DeviceIdleController$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;Ljava/lang/String;Ljava/lang/String;)V
+    invoke-static {v0, v1, v2}, Lcom/android/server/DeviceIdleController$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;Ljava/lang/String;Ljava/lang/String;)V
 
-    const/4 p0, 0x0
+    iget-boolean p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mCurtainModeIsRunning:Z
+
+    const/4 v0, 0x0
+
+    if-nez p0, :cond_2
+
+    const-string p0, "/sys/class/mdnie/mdnie1/accessibility"
+
+    invoke-static {p0}, Lcom/android/server/BatteryService$$ExternalSyntheticOutline0;->m(Ljava/lang/String;)Z
+
+    move-result v1
+
+    const-string v2, "/sys/class/mdnie/mdnie/accessibility"
+
+    if-eqz v1, :cond_1
+
+    invoke-static {p1, v2}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+    invoke-static {p1, p0}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
+
+    move-result p0
+
+    if-eqz p0, :cond_0
+
+    const/4 p0, 0x1
 
     return p0
+
+    :cond_0
+    return v0
+
+    :cond_1
+    invoke-static {p1, v2}, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->sysfsWrite(ILjava/lang/String;)Z
+
+    move-result p0
+
+    return p0
+
+    :cond_2
+    return v0
 .end method
 
 .method public final setmDNIeScreenCurtain(Z)Z
     .locals 4
 
-    iget-object p0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
+    iget-object v0, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mContext:Landroid/content/Context;
 
-    const-string/jumbo v0, "com.samsung.android.permission.CHANGE_DISPLAY_COLOR"
+    const-string/jumbo v1, "com.samsung.android.permission.CHANGE_DISPLAY_COLOR"
 
-    const-string/jumbo v1, "setmDNIeScreenCurtain"
+    const-string/jumbo v2, "setmDNIeScreenCurtain"
 
-    invoke-virtual {p0, v0, v1}, Landroid/content/Context;->enforceCallingOrSelfPermission(Ljava/lang/String;Ljava/lang/String;)V
+    invoke-virtual {v0, v1, v2}, Landroid/content/Context;->enforceCallingOrSelfPermission(Ljava/lang/String;Ljava/lang/String;)V
 
-    new-instance p0, Ljava/lang/StringBuilder;
+    new-instance v0, Ljava/lang/StringBuilder;
 
-    const-string/jumbo v0, "setmDNIeScreenCurtain ("
+    const-string/jumbo v1, "setmDNIeScreenCurtain ("
 
-    invoke-direct {p0, v0}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
+    invoke-direct {v0, v1}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V
 
-    invoke-virtual {p0, p1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
+    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;
 
-    const-string v0, ")"
+    const-string v1, ")"
 
-    const-string/jumbo v1, "SemMdnieManagerService"
+    const-string/jumbo v2, "SemMdnieManagerService"
 
-    invoke-static {p0, v0, v1}, Lcom/android/server/DeviceIdleController$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;Ljava/lang/String;Ljava/lang/String;)V
+    invoke-static {v0, v1, v2}, Lcom/android/server/DeviceIdleController$$ExternalSyntheticOutline0;->m(Ljava/lang/StringBuilder;Ljava/lang/String;Ljava/lang/String;)V
+
+    iput-boolean p1, p0, Lcom/samsung/android/hardware/display/SemMdnieManagerService;->mCurtainModeIsRunning:Z
 
     const/4 p0, 0x0
 
diff --git a/smali_classes2/com/samsung/android/knox/custom/KnoxCustomManagerService.smali b/smali_classes2/com/samsung/android/knox/custom/KnoxCustomManagerService.smali
index 8ae9b4c1..9d921dff 100644
--- a/smali_classes2/com/samsung/android/knox/custom/KnoxCustomManagerService.smali
+++ b/smali_classes2/com/samsung/android/knox/custom/KnoxCustomManagerService.smali
@@ -49783,27 +49783,213 @@
 .end method
 
 .method public final setScreenCurtainDirect()I
-    .locals 1
+    .locals 9
 
     iget-boolean v0, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mKnoxCustomCurtainModeIsRunning:Z
 
-    xor-int/lit8 v0, v0, 0x1
+    const/4 v1, 0x1
+
+    xor-int/2addr v0, v1
 
     iput-boolean v0, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mKnoxCustomCurtainModeIsRunning:Z
 
+    iget-object v0, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mContext:Landroid/content/Context;
+
+    const-string/jumbo v2, "mDNIe"
+
+    invoke-virtual {v0, v2}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+
+    move-result-object v0
+
+    check-cast v0, Lcom/samsung/android/hardware/display/SemMdnieManager;
+
+    iget-boolean v2, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mKnoxCustomCurtainModeIsRunning:Z
+
+    const/4 v3, 0x0
+
+    if-eqz v2, :cond_0
+
+    invoke-virtual {v0, v2}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setmDNIeScreenCurtain(Z)Z
+
+    goto/16 :goto_4
+
+    :cond_0
+    iget-object v2, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v2}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v2
+
+    const-string/jumbo v4, "high_contrast"
+
+    const/4 v5, -0x2
+
+    invoke-static {v2, v4, v3, v5}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result v2
+
+    if-ne v2, v1, :cond_1
+
+    move v2, v1
+
+    goto :goto_0
+
+    :cond_1
+    move v2, v3
+
+    :goto_0
+    iget-object v4, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v4}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v4
+
+    const-string/jumbo v6, "color_blind"
+
+    invoke-static {v4, v6, v3, v5}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result v4
+
+    if-ne v4, v1, :cond_2
+
+    move v4, v1
+
+    goto :goto_1
+
+    :cond_2
+    move v4, v3
+
+    :goto_1
+    iget-object v6, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v6}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v6
+
+    const-string/jumbo v7, "greyscale_mode"
+
+    invoke-static {v6, v7, v3, v5}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result v6
+
+    if-ne v6, v1, :cond_3
+
+    move v6, v1
+
+    goto :goto_2
+
+    :cond_3
+    move v6, v3
+
+    :goto_2
+    iget-object v7, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v7}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v7
+
+    const-string/jumbo v8, "powersaving_switch"
+
+    invoke-static {v7, v8, v3, v5}, Landroid/provider/Settings$System;->getIntForUser(Landroid/content/ContentResolver;Ljava/lang/String;II)I
+
+    move-result v5
+
+    if-ne v5, v1, :cond_4
+
+    move v5, v1
+
+    goto :goto_3
+
+    :cond_4
+    move v5, v3
+
+    :goto_3
+    if-eqz v2, :cond_5
+
+    if-eqz v6, :cond_5
+
+    const/4 p0, 0x5
+
+    invoke-virtual {v0, p0, v1}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setmDNIeAccessibilityMode(IZ)Z
+
+    goto :goto_4
+
+    :cond_5
+    if-eqz v5, :cond_6
+
+    const/16 p0, 0x9
+
+    :try_start_0
+    new-array p0, p0, [I
+
+    fill-array-data p0, :array_0
+
+    invoke-virtual {v0, v1, p0}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setmDNIeColorBlind(Z[I)Z
+    :try_end_0
+    .catch Ljava/lang/Exception; {:try_start_0 .. :try_end_0} :catch_0
+
+    goto :goto_4
+
+    :catch_0
+    move-exception p0
+
+    invoke-virtual {p0}, Ljava/lang/Exception;->printStackTrace()V
+
+    goto :goto_4
+
+    :cond_6
+    if-eqz v6, :cond_7
+
+    const/4 p0, 0x4
+
+    invoke-virtual {v0, p0, v1}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setmDNIeAccessibilityMode(IZ)Z
+
+    goto :goto_4
+
+    :cond_7
+    if-eqz v2, :cond_8
+
+    invoke-virtual {v0, v1}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setmDNIeNegative(Z)Z
+
+    goto :goto_4
+
+    :cond_8
+    if-eqz v4, :cond_9
+
+    new-instance v0, Landroid/content/Intent;
+
+    const-string/jumbo v1, "com.samsung.android.app.colorblind.ACTION_COLORBLIND_SWITCH_ON"
+
+    invoke-direct {v0, v1}, Landroid/content/Intent;-><init>(Ljava/lang/String;)V
+
     iget-object p0, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mContext:Landroid/content/Context;
 
-    const-string/jumbo v0, "mDNIe"
+    sget-object v1, Landroid/os/UserHandle;->ALL:Landroid/os/UserHandle;
 
-    invoke-virtual {p0, v0}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+    invoke-virtual {p0, v0, v1}, Landroid/content/Context;->sendBroadcastAsUser(Landroid/content/Intent;Landroid/os/UserHandle;)V
 
-    move-result-object p0
+    goto :goto_4
 
-    check-cast p0, Lcom/samsung/android/hardware/display/SemMdnieManager;
+    :cond_9
+    iget-boolean p0, p0, Lcom/samsung/android/knox/custom/KnoxCustomManagerService;->mKnoxCustomCurtainModeIsRunning:Z
 
-    const/4 p0, -0x6
+    invoke-virtual {v0, p0}, Lcom/samsung/android/hardware/display/SemMdnieManager;->setmDNIeScreenCurtain(Z)Z
 
-    return p0
+    :goto_4
+    return v3
+
+    :array_0
+    .array-data 4
+        0x4cb3
+        0x4cb3
+        0x4cb3
+        0x9669
+        0x9669
+        0x9669
+        0x1de2
+        0x1de2
+        0x1de2
+    .end array-data
 .end method
 
 .method public final setScreenOffOnHomeLongPressState(Z)I
-- 
2.51.0

